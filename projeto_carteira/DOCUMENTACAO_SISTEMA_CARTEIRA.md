# üìã DOCUMENTA√á√ÉO SISTEMA CARTEIRA DE PEDIDOS

## üéØ **VIS√ÉO GERAL**

O Sistema de Carteira de Pedidos foi **100% implementado** com 6 m√≥dulos distribu√≠dos em 3 blueprints Flask, totalizando **12 rotas** e **12 templates** funcionais.

### **üìä M√ìDULOS IMPLEMENTADOS:**
1. **FaturamentoProduto** - Faturamento detalhado por produto
2. **ProgramacaoProducao** - Planejamento da produ√ß√£o
3. **MovimentacaoEstoque** - Controle de estoque
4. **CadastroPalletizacao** - Fatores de convers√£o e dimens√µes
5. **CadastroRota** - Rotas por UF
6. **CadastroSubRota** - Sub-rotas por cidade

---

## üèóÔ∏è **ARQUITETURA IMPLEMENTADA**

### **üìÅ ORGANIZA√á√ÉO DOS M√ìDULOS:**
```
app/
‚îú‚îÄ‚îÄ faturamento/          # FaturamentoProduto
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # Modelo FaturamentoProduto
‚îÇ   ‚îî‚îÄ‚îÄ routes.py         # Rotas /faturamento/produtos*
‚îú‚îÄ‚îÄ producao/             # ProgramacaoProducao + CadastroPalletizacao  
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # ProgramacaoProducao + CadastroPalletizacao
‚îÇ   ‚îî‚îÄ‚îÄ routes.py         # Rotas /producao/* + /producao/palletizacao*
‚îú‚îÄ‚îÄ estoque/              # MovimentacaoEstoque
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # MovimentacaoEstoque
‚îÇ   ‚îî‚îÄ‚îÄ routes.py         # Rotas /estoque/*
‚îî‚îÄ‚îÄ localidades/          # CadastroRota + CadastroSubRota
    ‚îú‚îÄ‚îÄ models.py         # CadastroRota + CadastroSubRota
    ‚îî‚îÄ‚îÄ routes.py         # Rotas /localidades/rotas* + /localidades/sub-rotas*
```

---

## üîó **ROTAS IMPLEMENTADAS**

### **üßæ 1. FATURAMENTO POR PRODUTO** ‚úÖ **IMPLEMENTADO COMPLETO**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/faturamento/produtos` | GET | Listar faturamento por produto | `faturamento/listar_produtos.html` |
| `/faturamento/produtos/importar` | GET/POST | Importar dados de faturamento | `faturamento/importar_produtos.html` ‚úÖ |

**Colunas Excel espec√≠ficas**:
- `Linhas da fatura/NF-e` ‚Üí numero_nf
- `Linhas da fatura/Parceiro/CNPJ` ‚Üí cnpj_cliente  
- `Linhas da fatura/Parceiro` ‚Üí nome_cliente
- `Linhas da fatura/Parceiro/Munic√≠pio` ‚Üí municipio (extrai cidade/UF)
- `Linhas da fatura/Produto/Refer√™ncia` ‚Üí cod_produto
- `Linhas da fatura/Produto/Nome` ‚Üí nome_produto
- `Linhas da fatura/Quantidade` ‚Üí qtd_produto_faturado
- `Linhas da fatura/Valor Total do Item da NF` ‚Üí valor_produto_faturado
- `Linhas da fatura/Data` ‚Üí data_fatura
- `Status` ‚Üí status_nf (Forward Fill)
- `Vendedor` ‚Üí vendedor (Forward Fill)
- `Incoterm` ‚Üí incoterm (Forward Fill)

**Funcionalidades especiais**: Forward Fill autom√°tico, extra√ß√£o Cidade(UF), convers√£o valores BR, valida√ß√£o status

---

### **üè≠ 2. PROGRAMA√á√ÉO DE PRODU√á√ÉO** ‚úÖ **CORRIGIDO 29/06/2025**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/producao/` | GET | Dashboard produ√ß√£o | `producao/dashboard.html` |
| `/producao/programacao` | GET | Listar programa√ß√£o | `producao/listar_programacao.html` |
| `/producao/programacao/importar` | GET/POST | Importar programa√ß√£o | `producao/importar_programacao.html` ‚úÖ |

**üîß CORRE√á√ÉO APLICADA**: Rota de importa√ß√£o renomeada de `/producao/importar` para `/producao/programacao/importar` para coincidir com o template.

**Colunas Excel espec√≠ficas**:
- `DATA` ‚Üí data_programacao (formato DD/MM/YYYY)
- `SE√á√ÉO / M√ÅQUINA` ‚Üí linha_producao
- `C√ìDIGO` ‚Üí cod_produto
- `OP` ‚Üí observacao_pcp
- `DESCRI√á√ÉO` ‚Üí nome_produto
- `CLIENTE` ‚Üí cliente_produto
- `QTDE` ‚Üí qtd_programada

**Comportamento**: Sempre substitui dados existentes (limpa antes de importar)

---

### **üì¶ 3. MOVIMENTA√á√ÉO DE ESTOQUE** ‚úÖ **ATUALIZADA CONFORME ARQUIVO 6**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/estoque/` | GET | Dashboard estoque | `estoque/dashboard.html` |
| `/estoque/movimentacoes` | GET | Listar movimenta√ß√µes | `estoque/listar_movimentacoes.html` |
| `/estoque/movimentacoes/importar` | GET/POST | Importar movimenta√ß√µes | `estoque/importar_movimentacoes.html` ‚úÖ |

**Colunas Excel espec√≠ficas**:
- `tipo_movimentacao` ‚Üí tipo_movimentacao (EST INICIAL, AVARIA, DEVOLU√á√ÉO, PRODU√á√ÉO, RETRABALHO)
- `cod_produto` ‚Üí cod_produto
- `nome_produto` ‚Üí nome_produto 
- `local_movimentacao` ‚Üí local_movimentacao
- `data_movimentacao` ‚Üí data_movimentacao (formato DD/MM/YYYY)
- `qtd_movimentacao` ‚Üí qtd_movimentacao

**Comportamento**: Sempre adiciona registros (nunca remove)
**Valida√ß√µes**: Tipos permitidos validados automaticamente

---

### **‚öñÔ∏è 4. CADASTRO DE PALLETIZA√á√ÉO** ‚úÖ **ATUALIZADA CONFORME ARQUIVO 8**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/producao/palletizacao` | GET | Listar palletiza√ß√£o | `producao/listar_palletizacao.html` |
| `/producao/palletizacao/importar` | GET/POST | Importar palletiza√ß√£o | `producao/importar_palletizacao.html` ‚úÖ |

**Colunas Excel espec√≠ficas**:
- `C√≥d.Produto` ‚Üí cod_produto
- `Descri√ß√£o Produto` ‚Üí nome_produto
- `PALLETIZACAO` ‚Üí palletizacao (fator convers√£o para pallets)
- `PESO BRUTO` ‚Üí peso_bruto (fator convers√£o para peso)
- `altura_cm` ‚Üí altura_cm (opcional)
- `largura_cm` ‚Üí largura_cm (opcional)
- `comprimento_cm` ‚Üí comprimento_cm (opcional)

**Comportamento**: Substitui existentes, adiciona novos (por cod_produto)
**Funcionalidades**: C√°lculo autom√°tico de volume (altura √ó largura √ó comprimento)

---

### **üó∫Ô∏è 5. CADASTRO DE ROTAS** ‚úÖ **ATUALIZADA CONFORME ARQUIVO 9**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/localidades/rotas` | GET | Listar rotas | `localidades/listar_rotas.html` |
| `/localidades/rotas/importar` | GET/POST | Importar rotas | `localidades/importar_rotas.html` ‚úÖ |

**Colunas Excel espec√≠ficas**:
- `ESTADO` ‚Üí cod_uf (2 caracteres, ex: ES, SP, RJ)
- `ROTA` ‚Üí rota (descri√ß√£o da rota de entrega)

**Comportamento**: Substitui rota se UF j√° existe, adiciona novos
**Valida√ß√£o**: UF deve existir no cadastro de cidades

---

### **üéØ 6. CADASTRO DE SUB-ROTAS** ‚úÖ **ATUALIZADA CONFORME ARQUIVO 10**
| Rota | M√©todo | Fun√ß√£o | Template |
|------|--------|--------|----------|
| `/localidades/sub-rotas` | GET | Listar sub-rotas | `localidades/listar_sub_rotas.html` |
| `/localidades/sub-rotas/importar` | GET/POST | Importar sub-rotas | `localidades/importar_sub_rotas.html` ‚úÖ |

**Colunas Excel espec√≠ficas**:
- `ESTADO` ‚Üí cod_uf (2 caracteres, ex: AC, RJ, SP)
- `CIDADE` ‚Üí nome_cidade (nome da cidade, ex: RIO BRANCO)
- `SUB ROTA` ‚Üí sub_rota (descri√ß√£o da sub-rota, ex: CAP)

**Comportamento**: Sub rota √∫nica por combina√ß√£o UF+Cidade
**Valida√ß√£o**: Combina√ß√£o Cidade+UF deve existir no cadastro de cidades

---

## üé® **TEMPLATES IMPLEMENTADOS**

### **üìÑ TEMPLATES DE LISTAGEM (6 arquivos):**
```
app/templates/faturamento/listar_produtos.html     # Lista faturamento por produto
app/templates/producao/listar_programacao.html     # Lista programa√ß√£o de produ√ß√£o
app/templates/estoque/listar_movimentacoes.html    # Lista movimenta√ß√µes de estoque
app/templates/producao/listar_palletizacao.html    # Lista cadastro de palletiza√ß√£o
app/templates/localidades/listar_rotas.html        # Lista cadastro de rotas
app/templates/localidades/listar_sub_rotas.html    # Lista cadastro de sub-rotas
```

### **üì§ TEMPLATES DE IMPORTA√á√ÉO (6 arquivos):**
```
app/templates/faturamento/importar_produtos.html     # ‚úÖ Importar faturamento por produto
app/templates/producao/importar_programacao.html     # ‚úÖ Importar programa√ß√£o de produ√ß√£o
app/templates/estoque/importar_movimentacoes.html    # ‚úÖ Importar movimenta√ß√µes de estoque
app/templates/producao/importar_palletizacao.html    # ‚úÖ Importar cadastro de palletiza√ß√£o
app/templates/localidades/importar_rotas.html        # ‚úÖ Importar cadastro de rotas
app/templates/localidades/importar_sub_rotas.html    # ‚úÖ Importar cadastro de sub-rotas
```

---

## üî• **ATUALIZA√á√ïES REALIZADAS - JANEIRO 2025**

### **‚úÖ COMPLETAMENTE ATUALIZADAS CONFORME ARQUIVOS CSV:**

1. **Faturamento por Produto** (arquivo 3) - Forward Fill autom√°tico implementado
2. **Programa√ß√£o de Produ√ß√£o** (arquivo 5) - Colunas exatas mapeadas
3. **Movimenta√ß√µes de Estoque** (arquivo 6) - Tipos validados automaticamente
4. **Cadastro Palletiza√ß√£o** (arquivo 8) - Medidas opcionais inclu√≠das
5. **Cadastro de Rotas** (arquivo 9) - Valida√ß√£o com cadastro de cidades
6. **Cadastro de Sub-rotas** (arquivo 10) - Valida√ß√£o UF+Cidade

### **üéØ FUNCIONALIDADES ESPECIAIS IMPLEMENTADAS:**

- **Forward Fill**: Preenchimento autom√°tico de campos vazios (arquivo 3)
- **Extra√ß√£o Cidade/UF**: Parse autom√°tico "Cidade (UF)" ‚Üí campos separados
- **Convers√£o valores brasileiros**: 3.281,10 ‚Üí 3281.10 automaticamente
- **Valida√ß√£o status**: Status permitidos validados (Lan√ßado, Cancelado, Provis√≥rio)
- **Valida√ß√£o tipos**: Tipos movimenta√ß√£o validados automaticamente
- **C√°lculo autom√°tico**: Pre√ßo unit√°rio = valor_total √∑ quantidade
- **Volume autom√°tico**: C√°lculo m¬≥ baseado em dimens√µes
- **Valida√ß√£o referencial**: UF/Cidade devem existir no cadastro

### **üîÑ COMPORTAMENTOS ESPEC√çFICOS:**

| M√≥dulo | Comportamento | Justificativa |
|--------|---------------|---------------|
| **Faturamento** | Substitui/Adiciona | NF+Produto = chave √∫nica |
| **Programa√ß√£o** | Substitui tudo | Sempre limpa antes (planejamento) |
| **Estoque** | Sempre adiciona | Hist√≥rico de movimenta√ß√µes |
| **Palletiza√ß√£o** | Substitui/Adiciona | Cadastro mestre por produto |
| **Rotas** | Substitui/Adiciona | Rota √∫nica por UF |
| **Sub-rotas** | Substitui/Adiciona | Sub-rota √∫nica por UF+Cidade |

---

## üöÄ **URLs DE ACESSO**

### **üåê PRODU√á√ÉO (Render.com):**
```
https://frete-sistema.onrender.com/faturamento/produtos
https://frete-sistema.onrender.com/producao/programacao  
https://frete-sistema.onrender.com/estoque/movimentacoes
https://frete-sistema.onrender.com/producao/palletizacao
https://frete-sistema.onrender.com/localidades/rotas
https://frete-sistema.onrender.com/localidades/sub-rotas
```

---

## üìã **MODELOS DE DADOS**

### **üßæ FaturamentoProduto:**
```python
numero_nf, data_fatura, cnpj_cliente, nome_cliente, municipio, estado,
vendedor, incoterm, cod_produto, nome_produto, qtd_produto_faturado,
preco_produto_faturado, valor_produto_faturado
```

### **üè≠ ProgramacaoProducao:**
```python
data_programacao, cod_produto, nome_produto, qtd_programada,
linha_producao, cliente_produto, observacao_pcp
```

### **üì¶ MovimentacaoEstoque:**
```python
tipo_movimentacao, cod_produto, nome_produto, local_movimentacao,
data_movimentacao, qtd_movimentacao, observacao, documento_origem
```

### **‚öñÔ∏è CadastroPalletizacao:**
```python
cod_produto, nome_produto, palletizacao, peso_bruto,
altura_cm, largura_cm, comprimento_cm, volume_m3 (calculado)
```

### **üó∫Ô∏è CadastroRota:**
```python
cod_uf, rota, ativa
```

### **üéØ CadastroSubRota:**
```python
cod_uf, nome_cidade, sub_rota, ativa
```

---

## üéØ **COMPORTAMENTOS DE IMPORTA√á√ÉO**

| M√≥dulo | Comportamento | Chave √önica | Valida√ß√µes |
|--------|---------------|-------------|------------|
| **FaturamentoProduto** | üîÑ Substitui/Adiciona | numero_nf + cod_produto | Mapeamento flex√≠vel |
| **ProgramacaoProducao** | ‚ôªÔ∏è Sempre substitui | Per√≠odo completo | Data v√°lida |
| **MovimentacaoEstoque** | ‚ûï Sempre adiciona | - | Tipo movimenta√ß√£o |
| **CadastroPalletizacao** | üîÑ Substitui/Adiciona | cod_produto | Nenhuma |
| **CadastroRota** | üîÑ Substitui/Adiciona | cod_uf | UF em Cidade |
| **CadastroSubRota** | ÔøΩÔøΩ Substitui/Adiciona | cod_uf + nome_cidade | Cidade+UF em Cidade |


