# ü§ñ PROMPTS DO CLAUDE REAL INTEGRATION

## üìã √çNDICE
1. [System Prompt Principal](#system-prompt-principal)
2. [Prompt de Fallback Simulado](#prompt-de-fallback-simulado)
3. [Prompts de Resposta - Mem√≥ria Vital√≠cia](#prompts-de-resposta---mem√≥ria-vital√≠cia)
4. [Prompts de Resposta - Agendamentos](#prompts-de-resposta---agendamentos)
5. [Prompts de Resposta - Consulta NFs Espec√≠ficas](#prompts-de-resposta---consulta-nfs-espec√≠ficas)
6. [Configura√ß√£o da API Claude](#configura√ß√£o-da-api-claude)

---

## 1. System Prompt Principal

**Localiza√ß√£o:** `linha 209-225`
**Vari√°vel:** `self.system_prompt`

```python
self.system_prompt = \"\"\"Voc√™ √© Claude AI integrado ao Sistema de Fretes com ACESSO DIRETO ao banco de dados PostgreSQL, forms, models, routes, templates, etc.

üéØ **IMPORTANTE**: Voc√™ TEM ACESSO AUTOM√ÅTICO aos dados do sistema! Os dados abaixo foram carregados AUTOMATICAMENTE pelo seu sistema interno.

DADOS CARREGADOS AUTOMATICAMENTE DO BANCO:
{dados_contexto_especifico}

üß† **COMO VOC√ä FUNCIONA**:
‚Ä¢ Voc√™ ACESSA automaticamente o banco PostgreSQL quando recebe uma consulta
‚Ä¢ Os dados acima foram carregados pelo SEU pr√≥prio sistema de an√°lise
‚Ä¢ Voc√™ N√ÉO precisa que o usu√°rio forne√ßa dados - voc√™ j√° os tem
‚Ä¢ Analise os dados carregados e forne√ßa insights precisos baseados nos dados REAIS

‚ö° **CAPACIDADES ATIVAS**:
‚Ä¢ Acesso direto a 70+ tabelas do PostgreSQL
‚Ä¢ Carregamento autom√°tico de dados por dom√≠nio (entregas, fretes, pedidos, etc.)
‚Ä¢ Sistema de cache Redis para performance otimizada
Voce tem acesso a todas as tabelas do banco de dados, e pode consultar qualquer informa√ß√£o que voc√™ precisa.

Analise os dados carregados automaticamente e forne√ßa insights √∫teis baseados nos dados REAIS do sistema.\"\"\"
```

---

## 2. Prompt de Fallback Simulado

**Localiza√ß√£o:** `linha 2646-2666`
**Fun√ß√£o:** `_fallback_simulado()`

```python
return f\"\"\"ü§ñ **MODO SIMULADO** (Claude Real n√£o dispon√≠vel)

Consulta recebida: \"{consulta}\"

‚ö†Ô∏è **Para ativar Claude REAL:**
1. Configure ANTHROPIC_API_KEY nas vari√°veis de ambiente
2. Obtenha chave em: https://console.anthropic.com/
3. Reinicie o sistema

üí° **Com Claude 4 Sonnet Real voc√™ ter√°:**
- Intelig√™ncia industrial de ponta
- An√°lises contextuais precisas
- Diferencia√ß√£o rigorosa de clientes (Assai ‚â† Atacad√£o)
- M√©tricas calculadas automaticamente
- Performance otimizada com cache
- Dados completos com reagendamentos

üîÑ **Por enquanto, usando sistema b√°sico...\"\"\"
```

---

## 3. Prompts de Resposta - Mem√≥ria Vital√≠cia

**Localiza√ß√£o:** `linha 376-435`
**Contexto:** Quando usu√°rio pergunta sobre mem√≥ria/aprendizado do sistema

```python
resultado_memoria = f\"\"\"ü§ñ **CLAUDE 4 SONNET REAL**

üß† **MEM√ìRIA VITAL√çCIA DO SISTEMA**

Aqui est√° o que tenho armazenado no meu sistema de aprendizado cont√≠nuo:

üìä **ESTAT√çSTICAS GERAIS**:
‚Ä¢ **Total de Padr√µes Aprendidos**: {total_padroes}
‚Ä¢ **Mapeamentos Cliente-Empresa**: {total_mapeamentos}
‚Ä¢ **Grupos Empresariais Conhecidos**: {total_grupos}
‚Ä¢ **√öltima Atualiza√ß√£o**: {ultima_atualizacao}

üîç **EXEMPLOS DE PADR√ïES APRENDIDOS** (√∫ltimos 5):
[... padr√µes din√¢micos ...]

üè¢ **GRUPOS EMPRESARIAIS CONHECIDOS**:
[... grupos din√¢micos ...]

üí° **COMO FUNCIONA MEU APRENDIZADO**:

1. **Padr√µes de Consulta**: Aprendo como interpretar diferentes formas de fazer perguntas
2. **Mapeamento de Clientes**: Associo varia√ß√µes de nomes aos clientes corretos
3. **Grupos Empresariais**: Identifico empresas que pertencem ao mesmo grupo
4. **Corre√ß√µes do Usu√°rio**: Quando voc√™ me corrige, eu registro e aprendo
5. **Contexto Conversacional**: Mantenho hist√≥rico da conversa atual

‚ö° **CAPACIDADES ATIVAS**:
‚Ä¢ ‚úÖ Aprendizado cont√≠nuo com cada intera√ß√£o
‚Ä¢ ‚úÖ Detec√ß√£o autom√°tica de grupos empresariais
‚Ä¢ ‚úÖ Mem√≥ria conversacional na sess√£o atual
‚Ä¢ ‚úÖ Cache inteligente para respostas frequentes
‚Ä¢ ‚úÖ Corre√ß√£o autom√°tica de interpreta√ß√µes

üìà **EVOLU√á√ÉO**:
O sistema melhora continuamente. Cada consulta, corre√ß√£o e feedback contribui para aumentar minha precis√£o e velocidade de resposta.

---
üß† **Powered by:** Claude 4 Sonnet + Sistema de Aprendizado Vital√≠cio
üïí **Processado:** {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}
‚ö° **Fonte:** Banco de Dados PostgreSQL - Tabelas de Aprendizado\"\"\"
```

---

## 4. Prompts de Resposta - Agendamentos

### 4.1. Quando N√ÉO h√° agendamentos pendentes

**Localiza√ß√£o:** `linha 518-534`

```python
resultado_agendamentos = f\"\"\"ü§ñ **CLAUDE 4 SONNET REAL**

‚úÖ **AGENDAMENTOS - SITUA√á√ÉO EXCELENTE**

N√£o h√° entregas pendentes de agendamento no momento!

üìä **STATUS ATUAL**:
‚Ä¢ Total de entregas pendentes de agendamento: **0**
‚Ä¢ Todas as entregas recentes est√£o com agendamento confirmado
‚Ä¢ Sistema monitorado em tempo real

---
üß† **Powered by:** Claude 4 Sonnet (Anthropic) + Sistema de Alertas
üïí **Processado:** {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}
‚ö° **Fonte:** AlertEngine - Dados em tempo real\"\"\"
```

### 4.2. Quando H√Å agendamentos pendentes

**Localiza√ß√£o:** `linha 536-594`

```python
resultado_agendamentos = f\"\"\"ü§ñ **CLAUDE 4 SONNET REAL**

üìÖ **ENTREGAS COM AGENDAMENTO PENDENTE**

üö® **ATEN√á√ÉO**: {quantidade} entrega{'s' if quantidade > 1 else ''} {'precisam' if quantidade > 1 else 'precisa'} de agendamento

üìä **DETALHES DAS ENTREGAS PENDENTES**:
[... lista din√¢mica de entregas ...]

üéØ **A√á√ÉO NECESS√ÅRIA**:
1. Verificar forma de agendamento de cada cliente
2. Entrar em contato para agendar entregas
3. Registrar protocolos de agendamento no sistema

üí° **CRIT√âRIO USADO**:
‚Ä¢ Entregas embarcadas h√° mais de 3 dias
‚Ä¢ Sem data de entrega prevista definida
‚Ä¢ Status n√£o finalizado

üìã **COMO AGENDAR**:
‚Ä¢ Acesse o m√≥dulo de Monitoramento
‚Ä¢ Localize cada NF listada acima
‚Ä¢ Clique em \"Agendar\" para registrar o agendamento
‚Ä¢ Informe data, hora e protocolo

---
üß† **Powered by:** Claude 4 Sonnet (Anthropic) + AlertEngine
üïí **Processado:** {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}
‚ö° **Fonte:** Sistema de Alertas em Tempo Real
üìä **Crit√©rio:** Entregas sem data_entrega_prevista embarcadas h√° >3 dias\"\"\"
```

---

## 5. Prompts de Resposta - Consulta NFs Espec√≠ficas

**Localiza√ß√£o:** `linha 2667-2910`
**Fun√ß√£o:** `consultar_posicao_nfs_especificas()`

### 5.1. Cabe√ßalho da Resposta

```python
resposta = f\"\"\"üîç **POSI√á√ÉO DE ENTREGAS - {len(numeros_nf)} NFs CONSULTADAS**

üìä **RESUMO**: {nfs_encontradas} de {len(numeros_nf)} NFs encontradas ({nfs_encontradas/len(numeros_nf)*100:.1f}%)
\"\"\"
```

### 5.2. Se√ß√µes por Tipo de NF

```python
# Para Entrega Monitorada
resposta += f\"\"\"**NF {nf}** {status_icon} {pendencia_icon}
‚Ä¢ **Cliente**: {detalhes.get('cliente', 'N/A')}
‚Ä¢ **Status**: {status}
‚Ä¢ **Destino**: {detalhes.get('destino', 'N/A')} - {detalhes.get('uf', 'N/A')}
‚Ä¢ **Transportadora**: {detalhes.get('transportadora', 'N/A')}
‚Ä¢ **Vendedor**: {detalhes.get('vendedor', 'N/A')}
‚Ä¢ **Data Embarque**: {detalhes.get('data_embarque', 'N√£o embarcado')}
‚Ä¢ **Data Prevista**: {detalhes.get('data_prevista', 'Sem agendamento')}
‚Ä¢ **Data Realizada**: {detalhes.get('data_realizada', 'N√£o entregue')}
‚Ä¢ **Valor NF**: R$ {detalhes.get('valor_nf', 0):,.2f}\"\"\"

# Para Embarque
resposta += f\"\"\"**NF {nf}** {status_icon}
‚Ä¢ **Status**: {status}
‚Ä¢ **Embarque**: #{detalhes.get('numero_embarque', 'N/A')}
‚Ä¢ **Motorista**: {detalhes.get('motorista', 'N/A')}
‚Ä¢ **Placa**: {detalhes.get('placa_veiculo', 'N/A')}
‚Ä¢ **Data Embarque**: {detalhes.get('data_embarque', 'Aguardando')}
‚Ä¢ **Criado em**: {detalhes.get('data_criacao', 'N/A')}\"\"\"

# Para Pedido
resposta += f\"\"\"**NF {nf}** {status_icon}
‚Ä¢ **Status**: {status}
‚Ä¢ **Pedido**: {detalhes.get('num_pedido', 'N/A')}
‚Ä¢ **Cliente**: {detalhes.get('cliente', 'N/A')}
‚Ä¢ **Destino**: {detalhes.get('cidade', 'N/A')} - {detalhes.get('uf', 'N/A')}
‚Ä¢ **Valor**: R$ {detalhes.get('valor_total', 0):,.2f}
‚Ä¢ **Peso**: {detalhes.get('peso_total', 0):,.1f} kg
‚Ä¢ **Expedi√ß√£o**: {detalhes.get('expedicao', 'N/A')}
‚Ä¢ **Agendamento**: {detalhes.get('agendamento', 'Sem agendamento')}
‚Ä¢ **Transportadora**: {detalhes.get('transportadora', 'N√£o definida')}\"\"\"
```

### 5.3. Rodap√© da Consulta NFs

```python
resposta += f\"\"\"---
üîç **CONSULTA FINALIZADA**
üìä **Total consultado**: {len(numeros_nf)} NFs
‚úÖ **Encontradas**: {nfs_encontradas} NFs
‚ùå **N√£o encontradas**: {len(nfs_nao_encontradas)} NFs
üìà **Taxa de sucesso**: {nfs_encontradas/len(numeros_nf)*100:.1f}%

---
üß† **Powered by:** Claude 4 Sonnet (Anthropic) - Consulta Espec√≠fica de NFs
üïí **Processado:** {datetime.now().strftime('%d/%m/%Y %H:%M:%S')}
‚ö° **Modo:** Busca Multi-Tabela (Entregas + Embarques + Pedidos)\"\"\"
```

### 5.4. Resposta de Erro para NFs

```python
return f\"\"\"‚ùå **ERRO AO CONSULTAR POSI√á√ÉO DAS NFs**

**Erro t√©cnico**: {str(e)}

üîß **Solu√ß√µes**:
1. Verificar se os n√∫meros das NFs est√£o corretos
2. Tentar consulta com menos NFs por vez
3. Contactar suporte se erro persistir

üí° **Formato correto**: 6 d√≠gitos come√ßando com 1
**Exemplo**: 135497, 134451, 136077\"\"\"
```

---

## 6. Configura√ß√£o da API Claude

**Localiza√ß√£o:** `linha 943-956`
**Fun√ß√£o:** `processar_consulta_real()`

```python
response = self.client.messages.create(
    model="claude-sonnet-4-20250514",  # Claude 4 Sonnet
    max_tokens=4000,  # Restaurado para an√°lises completas
    temperature=0.0,  # M√°xima precis√£o - sem criatividade
    timeout=120.0,  # 2 minutos para an√°lises profundas
    system=self.system_prompt.format(
        dados_contexto_especifico=self._descrever_contexto_carregado(contexto_analisado)
    ),
    messages=messages  # type: ignore
)
```

### 6.1. Formata√ß√£o da Resposta Final

```python
resposta_final = f\"\"\"{resultado}

---
Claude 4 Sonnet | {datetime.now().strftime('%d/%m/%Y %H:%M')}\"\"\"
```

---

## üìù OBSERVA√á√ïES IMPORTANTES

### üéØ **Caracter√≠sticas dos Prompts:**

1. **System Prompt Din√¢mico**: O prompt principal √© formatado com dados reais do banco
2. **Respostas Contextuais**: Cada tipo de consulta tem seu pr√≥prio formato de resposta
3. **Branding Consistente**: Todos usam "ü§ñ **CLAUDE 4 SONNET REAL**"
4. **Timestamps**: Todas as respostas incluem data/hora de processamento
5. **Powered by**: Rodap√© com tecnologias utilizadas
6. **Emojis Funcionais**: Cada emoji tem significado espec√≠fico (üéØ, üìä, ‚úÖ, ‚ùå, etc.)

### üîß **Par√¢metros Claude API:**

- **Modelo**: `claude-sonnet-4-20250514` (Claude 4 Sonnet)
- **Temperature**: `0.0` (m√°xima precis√£o)
- **Max Tokens**: `4000` (an√°lises completas)
- **Timeout**: `120.0` segundos (2 minutos)

### üß† **Integra√ß√£o com Sistemas:**

- **Aprendizado Vital√≠cio**: Prompts usam dados aprendidos
- **Cache Redis**: Respostas s√£o cacheadas
- **Contexto Conversacional**: Mant√©m hist√≥rico da conversa
- **Multi-Agent System**: Fallback para outros sistemas IA
- **Human Learning**: Captura feedback automaticamente

---

**Arquivo gerado em:** `{datetime.now().strftime('%d/%m/%Y %H:%M:%S')}`  
**Fonte:** `app/claude_ai/claude_real_integration.py`  
**Total de Linhas Analisadas:** 3553 linhas 