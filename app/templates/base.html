<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Frete Sistema</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

{% if current_user.is_authenticated %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('main.dashboard') }}">Logistica Nacom Goya</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">

        <!-- OPERACIONAL - Fluxo principal do dia a dia -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="menuOperacional" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-tasks"></i> Operacional
          </a>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">ğŸ“¦ Pedidos e SeparaÃ§Ã£o</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('pedidos.lista_pedidos') }}">
              <i class="fas fa-list-alt"></i> Lista de Pedidos
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('separacao.listar') }}">
              <i class="fas fa-boxes"></i> SeparaÃ§Ã£o
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('separacao.importar') }}">
              <i class="fas fa-upload"></i> Importar SeparaÃ§Ã£o
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">ğŸš› Embarques</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('embarques.listar_embarques') }}">
              <i class="fas fa-shipping-fast"></i> Listar Embarques
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('portaria.dashboard') }}">
              <i class="fas fa-truck"></i> Controle de Portaria
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">ğŸ“‹ Monitoramento</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('monitoramento.listar_entregas') }}">
              <i class="fas fa-eye"></i> Entregas Monitoradas
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('portaria.historico') }}">
              <i class="fas fa-history"></i> HistÃ³rico da Portaria
            </a></li>
          </ul>
        </li>

        <!-- FINANCEIRO - GestÃ£o financeira -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="menuFinanceiro" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-dollar-sign"></i> Financeiro
          </a>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">ğŸ’° Fretes</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.index') }}">
              <i class="fas fa-tachometer-alt"></i> Dashboard Fretes
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.lancar_cte') }}">
              <i class="fas fa-plus-circle"></i> LanÃ§ar CTe
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.listar_fretes') }}">
              <i class="fas fa-list"></i> Listar Fretes
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.listar_aprovacoes') }}">
              <i class="fas fa-check-circle"></i> AprovaÃ§Ãµes
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.listar_faturas') }}">
              <i class="fas fa-file-pdf"></i> Faturas de Frete
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">ğŸ’¼ Financeiro</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('faturamento.listar_relatorios') }}">
              <i class="fas fa-chart-line"></i> RelatÃ³rio de Faturamento
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('financeiro.consultar_pendencias') }}">
              <i class="fas fa-exclamation-triangle"></i> PendÃªncias Financeiras
            </a></li>
          </ul>
        </li>

        <!-- CADASTROS - Dados mestres -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="menuCadastros" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-database"></i> Cadastros
          </a>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">âš™ï¸ Cadastros</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('transportadoras.cadastrar_transportadora') }}">
              <i class="fas fa-truck"></i> Transportadoras
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('portaria.cadastrar_motorista') }}">
              <i class="fas fa-user-plus"></i> Cadastrar Motorista
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('portaria.listar_motoristas') }}">
              <i class="fas fa-users"></i> Listar Motoristas
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('localidades.cadastrar_cidade') }}">
              <i class="fas fa-map-marker-alt"></i> Cidades
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastros_agendamento.listar_contatos') }}">
              <i class="fas fa-calendar-alt"></i> Agendamento
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">ğŸ“Š Tabelas de Frete</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('tabelas.cadastrar_tabela_frete') }}">
              <i class="fas fa-table"></i> Cadastro de Tabelas
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('tabelas.importar_tabela_frete') }}">
              <i class="fas fa-upload"></i> Importar Tabelas
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('tabelas.listar_todas_tabelas') }}">
              <i class="fas fa-eye"></i> Consulta de Tabelas
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('tabelas.historico_tabelas') }}">
              <i class="fas fa-history"></i> HistÃ³rico de Tabelas
            </a></li>
          </ul>
        </li>

        <!-- CONSULTAS - InformaÃ§Ãµes e anÃ¡lises -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="menuConsultas" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-search"></i> Consultas
          </a>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">ğŸ” Consultas</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('fretes.listar_fretes') }}">
              <i class="fas fa-search"></i> Buscar Fretes
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('veiculos.consulta_veiculos') }}">
              <i class="fas fa-car"></i> Consulta de VeÃ­culos
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('vinculos.consulta_vinculos') }}">
              <i class="fas fa-link"></i> Consulta de VÃ­nculos
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">ğŸ“¥ ImportaÃ§Ãµes</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastros_agendamento.importar_contatos') }}">
              <i class="fas fa-calendar-plus"></i> Agendamento
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('vinculos.importar_vinculos') }}">
              <i class="fas fa-link"></i> VÃ­nculos
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('financeiro.importar_pendencias') }}">
              <i class="fas fa-file-import"></i> PendÃªncias Financeiras
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('faturamento.importar_relatorio') }}">
              <i class="fas fa-file-upload"></i> RelatÃ³rio de Faturamento
            </a></li>
          </ul>
        </li>

        <!-- USUÃRIOS - GestÃ£o de usuÃ¡rios (apenas para admins e gerentes comerciais) -->
        {% if current_user.is_authenticated and current_user.pode_aprovar_usuarios() %}
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="menuUsuarios" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-users"></i> UsuÃ¡rios
          </a>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">ğŸ‘¤ GestÃ£o de UsuÃ¡rios</h6></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.usuarios_pendentes') }}">
              <i class="fas fa-user-clock text-warning"></i> Pendentes de AprovaÃ§Ã£o
            </a></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.listar_usuarios') }}">
              <i class="fas fa-users"></i> Todos os UsuÃ¡rios
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.registro') }}" target="_blank">
              <i class="fas fa-external-link-alt"></i> Link de Registro PÃºblico
            </a></li>
          </ul>
        </li>
        {% endif %}
        
        <!-- Logout -->
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.logout') }}">Sair</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endif %}

<div class="container mt-3">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

{% block content %}{% endblock %}

<!-- seus scripts atuais -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
  $(document).ready(function(){
    $('input[name="data_embarque"]').mask('00/00/0000');
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- âœ… Inclua claramente aqui o HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.11"></script>
<script>
  document.addEventListener("htmx:configRequest", function(event) {
    const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    if (token) {
      event.detail.headers['X-CSRFToken'] = token;
    }
  });
</script>

{% block scripts %}{% endblock %}
</body>
</html>

