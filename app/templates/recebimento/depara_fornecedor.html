{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-exchange-alt text-primary me-2"></i>De-Para Produto/Fornecedor</h2>
            <p class="text-muted mb-0">Mapeamento de codigos de produtos do fornecedor para codigos internos</p>
        </div>
        <div>
            <button type="button" class="btn btn-success me-2" onclick="abrirModalNovo()">
                <i class="fas fa-plus"></i> Novo De-Para
            </button>
            <button type="button" class="btn btn-outline-success me-2" onclick="abrirModalImportarExcel()">
                <i class="fas fa-file-excel"></i> Importar Excel
            </button>
            <button type="button" class="btn btn-outline-info me-2" onclick="importarDoOdoo()">
                <i class="fas fa-download"></i> Importar do Odoo
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i> Atualizar
            </button>
        </div>
    </div>

    <!-- Cards de Estatisticas -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-left-primary">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Total Ativos</h6>
                    <h2 class="mb-0 text-primary">{{ stats.total }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-left-success">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Sincronizados</h6>
                    <h2 class="mb-0 text-success">{{ stats.sincronizados }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-left-warning">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Pendentes Sync</h6>
                    <h2 class="mb-0 text-warning">{{ stats.pendentes }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros</h6>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('recebimento_views.depara_fornecedor') }}">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">CNPJ Fornecedor</label>
                        <input type="text" name="cnpj" class="form-control form-control-sm"
                               value="{{ filtros.cnpj }}" placeholder="Digite o CNPJ...">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Codigo Produto</label>
                        <input type="text" name="cod_produto" class="form-control form-control-sm"
                               value="{{ filtros.cod_produto }}" placeholder="Fornecedor ou interno...">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select name="ativo" class="form-select form-select-sm">
                            <option value="true" {% if filtros.ativo == 'true' %}selected{% endif %}>Ativos</option>
                            <option value="false" {% if filtros.ativo == 'false' %}selected{% endif %}>Inativos</option>
                            <option value="todos" {% if filtros.ativo == 'todos' %}selected{% endif %}>Todos</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary btn-sm me-2">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <a href="{{ url_for('recebimento_views.depara_fornecedor') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-times"></i> Limpar
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabela -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Fornecedor</th>
                            <th>Cod. Fornecedor</th>
                            <th>Cod. Interno</th>
                            <th class="text-center">UM Forn.</th>
                            <th class="text-center">Fator</th>
                            <th class="text-center">Sync</th>
                            <th class="text-center">Status</th>
                            <th class="text-center" style="width: 150px;">Acoes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr data-id="{{ item.id }}">
                            <td>
                                <strong>{{ item.razao_fornecedor or 'N/A' }}</strong>
                                <br><small class="text-muted">{{ item.cnpj_fornecedor }}</small>
                            </td>
                            <td>
                                <code>{{ item.cod_produto_fornecedor }}</code>
                                {% if item.descricao_produto_fornecedor %}
                                <br><small class="text-muted" title="{{ item.descricao_produto_fornecedor }}">
                                    {{ item.descricao_produto_fornecedor[:50] }}...
                                </small>
                                {% endif %}
                            </td>
                            <td>
                                <code class="text-primary">{{ item.cod_produto_interno }}</code>
                                {% if item.nome_produto_interno %}
                                <br><small class="text-muted">{{ item.nome_produto_interno[:40] }}...</small>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <span class="badge bg-secondary">{{ item.um_fornecedor or 'N/A' }}</span>
                            </td>
                            <td class="text-center">
                                {% if item.fator_conversao and item.fator_conversao != 1 %}
                                <span class="badge bg-info">{{ item.fator_conversao }}</span>
                                {% else %}
                                <span class="text-muted">1</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if item.sincronizado_odoo %}
                                <span class="badge bg-success"><i class="fas fa-check"></i></span>
                                {% else %}
                                <span class="badge bg-warning"><i class="fas fa-clock"></i></span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if item.ativo %}
                                <span class="badge bg-success">Ativo</span>
                                {% else %}
                                <span class="badge bg-danger">Inativo</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-primary" onclick="editarDepara({{ item.id }})"
                                        title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% if not item.sincronizado_odoo %}
                                <button class="btn btn-sm btn-outline-info" onclick="sincronizarDepara({{ item.id }})"
                                        title="Sincronizar com Odoo">
                                    <i class="fas fa-sync"></i>
                                </button>
                                {% endif %}
                                <button class="btn btn-sm btn-outline-danger" onclick="excluirDepara({{ item.id }})"
                                        title="Desativar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center text-muted py-4">
                                <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                                Nenhum De-Para encontrado
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Paginacao -->
    {% if paginacao.pages > 1 %}
    <nav class="mt-4">
        <ul class="pagination justify-content-center">
            {% if paginacao.page > 1 %}
            <li class="page-item">
                <a class="page-link" href="?page={{ paginacao.page - 1 }}&cnpj={{ filtros.cnpj }}&cod_produto={{ filtros.cod_produto }}&ativo={{ filtros.ativo }}">
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>
            {% endif %}

            {% for p in range(1, paginacao.pages + 1) %}
            <li class="page-item {% if p == paginacao.page %}active{% endif %}">
                <a class="page-link" href="?page={{ p }}&cnpj={{ filtros.cnpj }}&cod_produto={{ filtros.cod_produto }}&ativo={{ filtros.ativo }}">{{ p }}</a>
            </li>
            {% endfor %}

            {% if paginacao.page < paginacao.pages %}
            <li class="page-item">
                <a class="page-link" href="?page={{ paginacao.page + 1 }}&cnpj={{ filtros.cnpj }}&cod_produto={{ filtros.cod_produto }}&ativo={{ filtros.ativo }}">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>

<!-- Modal Novo/Editar De-Para -->
<div class="modal fade" id="modalDepara" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalDeparaTitle">Novo De-Para</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formDepara">
                    <input type="hidden" id="deparaId" name="id">

                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3">Dados do Fornecedor</h6>

                            <div class="mb-3">
                                <label class="form-label">CNPJ Fornecedor *</label>
                                <input type="text" class="form-control" id="cnpjFornecedor" name="cnpj_fornecedor" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Razao Social</label>
                                <input type="text" class="form-control" id="razaoFornecedor" name="razao_fornecedor">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Codigo Produto Fornecedor *</label>
                                <input type="text" class="form-control" id="codProdutoFornecedor" name="cod_produto_fornecedor" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Descricao Produto Fornecedor</label>
                                <input type="text" class="form-control" id="descProdutoFornecedor" name="descricao_produto_fornecedor">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h6 class="text-success mb-3">Dados Internos</h6>

                            <div class="mb-3">
                                <label class="form-label">Codigo Produto Interno *</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="codProdutoInterno" name="cod_produto_interno" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="buscarProdutoOdoo()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Nome Produto Interno</label>
                                <input type="text" class="form-control" id="nomeProdutoInterno" name="nome_produto_interno" readonly>
                            </div>

                            <input type="hidden" id="odooProductId" name="odoo_product_id">

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">UM Fornecedor</label>
                                        <input type="text" class="form-control" id="umFornecedor" name="um_fornecedor"
                                               placeholder="Ex: ML, MI, MIL" onchange="sugerirFator()">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Fator Conversao</label>
                                        <input type="number" class="form-control" id="fatorConversao" name="fator_conversao"
                                               value="1" step="0.0001" min="0.0001">
                                        <small class="text-muted">1 UM Forn. = X unidades</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="salvarDepara()">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Importar Excel -->
<div class="modal fade" id="modalImportarExcel" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="fas fa-file-excel me-2"></i>Importar De-Para via Excel</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Instrucoes -->
                <div class="alert alert-info">
                    <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Instrucoes</h6>
                    <ul class="mb-0">
                        <li>Baixe o <a href="#" onclick="baixarTemplateExcel(); return false;">template Excel</a> como modelo</li>
                        <li>Preencha as colunas obrigatorias: <code>cnpj_fornecedor</code>, <code>cod_produto_fornecedor</code>, <code>cod_produto_interno</code></li>
                        <li>Colunas opcionais: <code>descricao_produto_fornecedor</code>, <code>um_fornecedor</code>, <code>fator_conversao</code></li>
                        <li>Se existir De-Para com mesmo CNPJ+Codigo, sera atualizado</li>
                    </ul>
                </div>

                <!-- Upload -->
                <form id="formImportarExcel" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Arquivo Excel *</label>
                        <input type="file" class="form-control" id="arquivoExcel" name="arquivo"
                               accept=".xlsx,.xls" required onchange="previewExcel()">
                        <small class="text-muted">Arquivos aceitos: .xlsx, .xls</small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="autoSyncOdoo" name="auto_sync_odoo" checked>
                            <label class="form-check-label" for="autoSyncOdoo">
                                Sincronizar automaticamente com Odoo
                            </label>
                        </div>
                    </div>

                    <!-- Preview -->
                    <div id="previewContainer" style="display: none;">
                        <h6 class="mt-4 mb-2"><i class="fas fa-eye me-2"></i>Preview (primeiras 5 linhas)</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered" id="tabelaPreview">
                                <thead class="table-light"></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <p class="text-muted small" id="previewInfo"></p>
                    </div>
                </form>

                <!-- Resultado -->
                <div id="resultadoImportacao" style="display: none;" class="mt-4">
                    <h6><i class="fas fa-check-circle text-success me-2"></i>Resultado da Importacao</h6>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body py-2">
                                    <h4 id="resCriados" class="mb-0">0</h4>
                                    <small>Criados</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card bg-info text-white">
                                <div class="card-body py-2">
                                    <h4 id="resAtualizados" class="mb-0">0</h4>
                                    <small>Atualizados</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card bg-danger text-white">
                                <div class="card-body py-2">
                                    <h4 id="resErros" class="mb-0">0</h4>
                                    <small>Erros</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="listaErros" class="mt-3" style="display: none;">
                        <h6 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Detalhes dos Erros</h6>
                        <div class="overflow-auto" style="max-height: 200px;">
                            <ul class="list-group list-group-flush" id="ulErros"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-link" onclick="baixarTemplateExcel(); return false;">
                    <i class="fas fa-download"></i> Baixar Template
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-success" id="btnProcessarExcel" onclick="processarExcel()">
                    <i class="fas fa-upload"></i> Processar Importacao
                </button>
            </div>
        </div>
    </div>
</div>

<script>
const modalDepara = new bootstrap.Modal(document.getElementById('modalDepara'));
const modalImportarExcel = new bootstrap.Modal(document.getElementById('modalImportarExcel'));

function abrirModalNovo() {
    document.getElementById('modalDeparaTitle').textContent = 'Novo De-Para';
    document.getElementById('formDepara').reset();
    document.getElementById('deparaId').value = '';
    document.getElementById('fatorConversao').value = '1';
    modalDepara.show();
}

function editarDepara(id) {
    fetch(`/api/recebimento/depara/${id}`)
        .then(r => r.json())
        .then(data => {
            if (data.sucesso) {
                const d = data.depara;
                document.getElementById('modalDeparaTitle').textContent = 'Editar De-Para';
                document.getElementById('deparaId').value = d.id;
                document.getElementById('cnpjFornecedor').value = d.cnpj_fornecedor;
                document.getElementById('razaoFornecedor').value = d.razao_fornecedor || '';
                document.getElementById('codProdutoFornecedor').value = d.cod_produto_fornecedor;
                document.getElementById('descProdutoFornecedor').value = d.descricao_produto_fornecedor || '';
                document.getElementById('codProdutoInterno').value = d.cod_produto_interno;
                document.getElementById('nomeProdutoInterno').value = d.nome_produto_interno || '';
                document.getElementById('odooProductId').value = d.odoo_product_id || '';
                document.getElementById('umFornecedor').value = d.um_fornecedor || '';
                document.getElementById('fatorConversao').value = d.fator_conversao || 1;
                modalDepara.show();
            } else {
                alert('Erro ao buscar De-Para: ' + data.erro);
            }
        });
}

function salvarDepara() {
    const id = document.getElementById('deparaId').value;
    const method = id ? 'PUT' : 'POST';
    const url = id ? `/api/recebimento/depara/${id}` : '/api/recebimento/depara';

    const dados = {
        cnpj_fornecedor: document.getElementById('cnpjFornecedor').value,
        razao_fornecedor: document.getElementById('razaoFornecedor').value,
        cod_produto_fornecedor: document.getElementById('codProdutoFornecedor').value,
        descricao_produto_fornecedor: document.getElementById('descProdutoFornecedor').value,
        cod_produto_interno: document.getElementById('codProdutoInterno').value,
        nome_produto_interno: document.getElementById('nomeProdutoInterno').value,
        odoo_product_id: document.getElementById('odooProductId').value || null,
        um_fornecedor: document.getElementById('umFornecedor').value,
        fator_conversao: parseFloat(document.getElementById('fatorConversao').value) || 1
    };

    fetch(url, {
        method: method,
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(dados)
    })
    .then(r => r.json())
    .then(data => {
        if (data.sucesso) {
            modalDepara.hide();
            location.reload();
        } else {
            alert('Erro: ' + data.erro);
        }
    });
}

function excluirDepara(id) {
    if (!confirm('Deseja desativar este De-Para?')) return;

    fetch(`/api/recebimento/depara/${id}`, {method: 'DELETE'})
        .then(r => r.json())
        .then(data => {
            if (data.sucesso) {
                location.reload();
            } else {
                alert('Erro: ' + data.erro);
            }
        });
}

function sincronizarDepara(id) {
    fetch('/api/recebimento/depara/sincronizar-odoo', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({depara_id: id})
    })
    .then(r => r.json())
    .then(data => {
        if (data.sucesso) {
            alert('Sincronizado com sucesso!');
            location.reload();
        } else {
            alert('Erro: ' + data.erro);
        }
    });
}

function importarDoOdoo() {
    if (!confirm('Importar De-Para do Odoo (product.supplierinfo)?')) return;

    fetch('/api/recebimento/depara/importar-odoo', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({limit: 500})
    })
    .then(r => r.json())
    .then(data => {
        if (data.sucesso) {
            alert(`Importacao concluida!\nImportados: ${data.importados}\nAtualizados: ${data.atualizados}\nErros: ${data.erros}`);
            location.reload();
        } else {
            alert('Erro: ' + data.erro);
        }
    });
}

function buscarProdutoOdoo() {
    const cod = document.getElementById('codProdutoInterno').value;
    if (!cod) {
        alert('Digite o codigo do produto');
        return;
    }

    fetch(`/api/recebimento/buscar-produto-odoo?cod_produto=${cod}`)
        .then(r => r.json())
        .then(data => {
            if (data.sucesso) {
                document.getElementById('nomeProdutoInterno').value = data.produto.name;
                document.getElementById('odooProductId').value = data.produto.id;
            } else {
                alert(data.erro);
            }
        });
}

function sugerirFator() {
    const um = document.getElementById('umFornecedor').value;
    if (!um) return;

    fetch(`/api/recebimento/depara/sugerir-fator?um_fornecedor=${um}`)
        .then(r => r.json())
        .then(data => {
            if (data.sucesso && data.fator_sugerido > 1) {
                document.getElementById('fatorConversao').value = data.fator_sugerido;
            }
        });
}

// ========== FUNCOES IMPORTAR EXCEL ==========

function abrirModalImportarExcel() {
    // Reset estado
    document.getElementById('formImportarExcel').reset();
    document.getElementById('previewContainer').style.display = 'none';
    document.getElementById('resultadoImportacao').style.display = 'none';
    document.getElementById('btnProcessarExcel').disabled = false;
    document.getElementById('btnProcessarExcel').innerHTML = '<i class="fas fa-upload"></i> Processar Importacao';
    modalImportarExcel.show();
}

function baixarTemplateExcel() {
    window.location.href = '/api/recebimento/depara/template-excel';
}

function previewExcel() {
    const arquivo = document.getElementById('arquivoExcel').files[0];
    if (!arquivo) {
        document.getElementById('previewContainer').style.display = 'none';
        return;
    }

    // Usar SheetJS (se disponivel) ou mostrar apenas info do arquivo
    document.getElementById('previewContainer').style.display = 'block';
    document.getElementById('previewInfo').textContent = `Arquivo: ${arquivo.name} (${(arquivo.size / 1024).toFixed(2)} KB)`;

    // Limpar tabela preview
    const thead = document.querySelector('#tabelaPreview thead');
    const tbody = document.querySelector('#tabelaPreview tbody');
    thead.innerHTML = '<tr><td class="text-muted text-center" colspan="6"><i class="fas fa-spinner fa-spin me-2"></i>Preparando preview...</td></tr>';
    tbody.innerHTML = '';
}

function processarExcel() {
    const arquivo = document.getElementById('arquivoExcel').files[0];
    if (!arquivo) {
        alert('Selecione um arquivo Excel');
        return;
    }

    const btn = document.getElementById('btnProcessarExcel');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processando...';

    const formData = new FormData();
    formData.append('arquivo', arquivo);
    formData.append('auto_sync_odoo', document.getElementById('autoSyncOdoo').checked ? 'true' : 'false');

    fetch('/api/recebimento/depara/importar-excel', {
        method: 'POST',
        body: formData
    })
    .then(r => r.json())
    .then(data => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-upload"></i> Processar Importacao';

        if (data.sucesso) {
            // Exibir resultado
            document.getElementById('resultadoImportacao').style.display = 'block';
            document.getElementById('resCriados').textContent = data.criados || 0;
            document.getElementById('resAtualizados').textContent = data.atualizados || 0;
            document.getElementById('resErros').textContent = data.erros ? data.erros.length : 0;

            // Exibir lista de erros se houver
            if (data.erros && data.erros.length > 0) {
                document.getElementById('listaErros').style.display = 'block';
                const ul = document.getElementById('ulErros');
                ul.innerHTML = data.erros.map(e =>
                    `<li class="list-group-item list-group-item-${e.warning ? 'warning' : 'danger'} py-1">
                        <small><strong>Linha ${e.linha}:</strong> ${e.erro}</small>
                    </li>`
                ).join('');
            } else {
                document.getElementById('listaErros').style.display = 'none';
            }

            // Mostrar mensagem de sucesso
            if (data.criados > 0 || data.atualizados > 0) {
                setTimeout(() => {
                    if (confirm('Importacao concluida! Deseja recarregar a pagina?')) {
                        location.reload();
                    }
                }, 500);
            }
        } else {
            alert('Erro na importacao: ' + data.erro);
        }
    })
    .catch(err => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-upload"></i> Processar Importacao';
        alert('Erro de comunicacao: ' + err.message);
    });
}
</script>
{% endblock %}
