{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4" style="max-width: 900px;">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                <i class="fas fa-motorcycle"></i>
                {% if moto %}Editar Moto{% else %}Nova Moto{% endif %}
            </h4>
        </div>
        <div class="card-body">
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <!-- Identificação da Moto -->
                <h5 class="mb-3"><i class="fas fa-id-card"></i> Identificação</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="numero_chassi" class="form-label">Número do Chassi *</label>
                        <input type="text" class="form-control" id="numero_chassi" name="numero_chassi"
                               value="{{ moto.numero_chassi if moto else '' }}"
                               {% if moto %}readonly{% endif %}
                               required>
                        {% if moto %}
                        <small class="text-muted">Chassi não pode ser alterado (é chave primária)</small>
                        {% else %}
                        <small class="text-muted">17 caracteres, único no sistema</small>
                        {% endif %}
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="numero_motor" class="form-label">Número do Motor *</label>
                        <input type="text" class="form-control" id="numero_motor" name="numero_motor"
                               value="{{ moto.numero_motor if moto else '' }}" required>
                        <small class="text-muted">Único no sistema</small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="modelo_id" class="form-label">Modelo *</label>
                        <select class="form-select" id="modelo_id" name="modelo_id" required>
                            <option value="">Selecione o modelo...</option>
                            {% for m in modelos %}
                            <option value="{{ m.id }}"
                                    {% if moto and moto.modelo_id == m.id %}selected{% endif %}>
                                {{ m.nome_modelo }} - {{ m.potencia_motor }}
                                (R$ {{ "%.2f"|format(m.preco_tabela) }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="cor" class="form-label">Cor *</label>
                        <input type="text" class="form-control" id="cor" name="cor"
                               value="{{ moto.cor if moto else '' }}"
                               placeholder="Ex: Vermelho, Preto, Branco" required>
                    </div>

                    <div class="col-md-2 mb-3">
                        <label for="ano_fabricacao" class="form-label">Ano</label>
                        <input type="number" class="form-control" id="ano_fabricacao" name="ano_fabricacao"
                               value="{{ moto.ano_fabricacao if moto else '' }}"
                               min="2020" max="2030">
                    </div>
                </div>

                <hr class="my-4">

                <!-- Dados de Entrada (NF) -->
                <h5 class="mb-3"><i class="fas fa-file-invoice"></i> Dados de Entrada (Nota Fiscal)</h5>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="nf_entrada" class="form-label">Número NF *</label>
                        <input type="text" class="form-control" id="nf_entrada" name="nf_entrada"
                               value="{{ moto.nf_entrada if moto else '' }}" required>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="data_nf_entrada" class="form-label">Data NF *</label>
                        <input type="date" class="form-control" id="data_nf_entrada" name="data_nf_entrada"
                               value="{{ moto.data_nf_entrada.strftime('%Y-%m-%d') if moto and moto.data_nf_entrada else '' }}" required>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="data_entrada" class="form-label">Data Entrada *</label>
                        <input type="date" class="form-control" id="data_entrada" name="data_entrada"
                               value="{{ moto.data_entrada.strftime('%Y-%m-%d') if moto and moto.data_entrada else '' }}" required>
                        <small class="text-muted">Usado para FIFO</small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="fornecedor" class="form-label">Fornecedor *</label>
                        <input type="text" class="form-control" id="fornecedor" name="fornecedor"
                               value="{{ moto.fornecedor if moto else '' }}"
                               placeholder="Nome do fornecedor" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="custo_aquisicao" class="form-label">Custo de Aquisição (R$) *</label>
                        <input type="number" step="0.01" class="form-control" id="custo_aquisicao" name="custo_aquisicao"
                               value="{{ moto.custo_aquisicao if moto else '' }}" required>
                    </div>
                </div>

                <hr class="my-4">

                <!-- Estoque e Status -->
                <h5 class="mb-3"><i class="fas fa-warehouse"></i> Estoque e Status</h5>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="pallet" class="form-label">Pallet</label>
                        <input type="text" class="form-control" id="pallet" name="pallet"
                               value="{{ moto.pallet if moto else '' }}"
                               placeholder="Ex: P01, P02">
                        <small class="text-muted">Localização física no estoque</small>
                    </div>

                    {% if moto %}
                    <div class="col-md-4 mb-3">
                        <label for="status" class="form-label">Status *</label>
                        <select class="form-select" id="status" name="status" required>
                            <option value="DISPONIVEL" {% if moto.status == 'DISPONIVEL' %}selected{% endif %}>Disponível</option>
                            <option value="RESERVADA" {% if moto.status == 'RESERVADA' %}selected{% endif %}>Reservada</option>
                            <option value="VENDIDA" {% if moto.status == 'VENDIDA' %}selected{% endif %}>Vendida</option>
                        </select>
                        <small class="text-muted">Controle FIFO e reserva</small>
                    </div>
                    {% endif %}
                </div>

                {% if moto %}
                <div class="card bg-light mb-3">
                    <div class="card-body">
                        <h6><i class="fas fa-info-circle"></i> Informações do Sistema</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <strong>Disponível para Venda:</strong>
                                    {% if moto.disponivel_para_venda %}
                                    <span class="badge bg-success">Sim</span>
                                    {% else %}
                                    <span class="badge bg-danger">Não</span>
                                    {% endif %}
                                    <br>
                                    <strong>Reservado:</strong>
                                    {% if moto.reservado %}
                                    <span class="badge bg-warning">Sim</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Não</span>
                                    {% endif %}
                                </small>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <strong>Criado em:</strong> {{ moto.criado_em.strftime('%d/%m/%Y %H:%M') if moto.criado_em else '-' }}<br>
                                    <strong>Criado por:</strong> {{ moto.criado_por or '-' }}<br>
                                    {% if moto.atualizado_em %}
                                    <strong>Última atualização:</strong> {{ moto.atualizado_em.strftime('%d/%m/%Y %H:%M') }}<br>
                                    <strong>Por:</strong> {{ moto.atualizado_por or '-' }}
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                    <a href="{{ url_for('motochefe.listar_motos') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
