{
  "name": "historico_requisicao_compras",
  "description": "Histórico COMPLETO (snapshot) de Requisições de Compras",
  "fields": [
    {
      "name": "id",
      "type": "integer",
      "description": "Primary key"
    },
    {
      "name": "requisicao_id",
      "type": "integer",
      "description": "FK → requisicao_compras.id",
      "nullable": false
    },
    {
      "name": "operacao",
      "type": "varchar(20)",
      "description": "'CRIAR', 'EDITAR'",
      "nullable": false
    },
    {
      "name": "alterado_em",
      "type": "timestamp",
      "nullable": false
    },
    {
      "name": "alterado_por",
      "type": "varchar(100)",
      "description": "'Odoo' ou usuário",
      "nullable": false
    },
    {
      "name": "write_date_odoo",
      "type": "timestamp"
    },
    {
      "name": "num_requisicao",
      "type": "varchar(30)",
      "nullable": false
    },
    {
      "name": "company_id",
      "type": "varchar(100)",
      "description": "Empresa compradora"
    },
    {
      "name": "data_requisicao_criacao",
      "type": "date",
      "nullable": false
    },
    {
      "name": "usuario_requisicao_criacao",
      "type": "varchar(100)"
    },
    {
      "name": "lead_time_requisicao",
      "type": "integer"
    },
    {
      "name": "lead_time_previsto",
      "type": "integer"
    },
    {
      "name": "data_requisicao_solicitada",
      "type": "date"
    },
    {
      "name": "cod_produto",
      "type": "varchar(50)",
      "nullable": false
    },
    {
      "name": "nome_produto",
      "type": "varchar(255)"
    },
    {
      "name": "qtd_produto_requisicao",
      "type": "numeric(15,3)",
      "nullable": false
    },
    {
      "name": "qtd_produto_sem_requisicao",
      "type": "numeric(15,3)",
      "default": 0
    },
    {
      "name": "necessidade",
      "type": "boolean",
      "default": false
    },
    {
      "name": "data_necessidade",
      "type": "date"
    },
    {
      "name": "status",
      "type": "varchar(20)",
      "default": "Pendente"
    },
    {
      "name": "importado_odoo",
      "type": "boolean",
      "default": false
    },
    {
      "name": "odoo_id",
      "type": "varchar(50)"
    },
    {
      "name": "requisicao_odoo_id",
      "type": "varchar(50)"
    },
    {
      "name": "status_requisicao",
      "type": "varchar(20)",
      "default": "rascunho"
    },
    {
      "name": "data_envio_odoo",
      "type": "timestamp"
    },
    {
      "name": "data_confirmacao_odoo",
      "type": "timestamp"
    },
    {
      "name": "observacoes_odoo",
      "type": "text"
    },
    {
      "name": "criado_em",
      "type": "timestamp",
      "description": "Data de criação"
    }
  ],
  "foreign_keys": [
    {
      "column": "requisicao_id",
      "references": "requisicao_compras.id"
    }
  ],
  "indices": [
    {
      "name": "idx_hist_req_requisicao_data",
      "columns": [
        "requisicao_id",
        "alterado_em"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_cod_produto",
      "columns": [
        "cod_produto"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_operacao",
      "columns": [
        "operacao"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_num_requisicao",
      "columns": [
        "num_requisicao"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_alterado_em",
      "columns": [
        "alterado_em"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_requisicao_id",
      "columns": [
        "requisicao_id"
      ],
      "unique": false
    },
    {
      "name": "ix_historico_requisicao_compras_alterado_por",
      "columns": [
        "alterado_por"
      ],
      "unique": false
    },
    {
      "name": "idx_hist_req_num_data",
      "columns": [
        "num_requisicao",
        "alterado_em"
      ],
      "unique": false
    }
  ]
}