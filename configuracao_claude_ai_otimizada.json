{
  "versao": "2.0",
  "sistema": "Mapeamento Semântico Otimizado",
  "atualizado_em": "2025-06-25",
  
  "modelos_prioritarios": {
    "criticos": [
      {
        "nome": "EntregaMonitorada",
        "tabela": "entregas_monitoradas", 
        "uso": "monitoramento_principal",
        "frequencia": 45,
        "campos_chave": ["numero_nf", "cliente", "data_entrega_prevista", "entregue"],
        "contexto": "Acompanhamento de entregas em tempo real"
      },
      {
        "nome": "Pedido",
        "tabela": "pedidos",
        "uso": "base_operacional", 
        "frequencia": 20,
        "campos_chave": ["num_pedido", "raz_social_red", "status", "data_pedido"],
        "contexto": "Gestão de pedidos e cotações"
      },
      {
        "nome": "Embarque", 
        "tabela": "embarques",
        "uso": "logistica_operacional",
        "frequencia": 10,
        "campos_chave": ["numero", "data_embarque", "status", "tipo_carga"],
        "contexto": "Controle de embarques e expedição"
      }
    ],
    "importantes": [
      {
        "nome": "Frete",
        "tabela": "fretes", 
        "uso": "controle_financeiro",
        "frequencia": 15,
        "campos_chave": ["valor_cotado", "status", "aprovado_por"],
        "contexto": "Gestão financeira de fretes"
      }
    ]
  },

  "mapeamento_linguagem_natural": {
    "cliente": {
      "campos_origem": ["raz_social_red", "nome_cliente", "cliente"],
      "sinonimos": ["cliente", "comprador", "empresa", "razão social", "nome da empresa"],
      "exemplos_reais": ["atacadão", "assai", "carrefour", "extra", "pão de açúcar"],
      "busca_sql": "raz_social_red ILIKE '%{termo}%'"
    },
    "status": {
      "campos_origem": ["status", "status_finalizacao"],
      "valores_validos": {
        "pedido": ["ABERTO", "COTADO", "EMBARCADO", "FATURADO"],
        "entrega": ["Entregue", "Cancelada", "Devolvida", "NF no CD"]
      },
      "sinonimos": {
        "ABERTO": ["aberto", "disponível", "sem embarque"],
        "ENTREGUE": ["entregue", "concluído", "finalizado"],
        "ATRASADO": ["atrasado", "vencido", "pendente"]
      }
    },
    "data_entrega": {
      "campos_origem": ["data_entrega_prevista", "data_agenda"],
      "sinonimos": ["entrega", "previsão", "quando entrega", "prazo", "agendamento"],
      "contexto": "Data prevista ou agendada para entrega"
    },
    "transportadora": {
      "campos_origem": ["transportadora", "razao_social"],
      "exemplos_reais": [
        "Transportadora Teste 1 Ltda",
        "Freteiro Autônomo Silva", 
        "Transportes Express"
      ],
      "sinonimos": ["transportadora", "freteiro", "empresa de transporte"]
    }
  },

  "consultas_mais_comuns": {
    "entregas_atrasadas": {
      "frequencia_percentual": 45,
      "padroes_deteccao": ["atrasadas", "atraso", "vencidas", "pendentes"],
      "sql_template": "SELECT numero_nf, cliente, data_entrega_prevista, municipio FROM entregas_monitoradas WHERE entregue = false AND data_entrega_prevista < CURRENT_DATE",
      "filtros_comuns": ["cliente", "uf", "vendedor"]
    },
    "status_pedidos": {
      "frequencia_percentual": 20,
      "padroes_deteccao": ["status", "situação", "posição", "andamento"],
      "sql_template": "SELECT num_pedido, raz_social_red, status, data_pedido FROM pedidos WHERE 1=1",
      "filtros_comuns": ["cliente", "periodo", "status"]
    },
    "fretes_aprovacao": {
      "frequencia_percentual": 15, 
      "padroes_deteccao": ["aprovação", "pendente aprovação", "aguardando"],
      "sql_template": "SELECT f.valor_cotado, f.status, t.razao_social FROM fretes f JOIN transportadoras t ON f.transportadora_id = t.id WHERE f.status = 'PENDENTE'",
      "filtros_comuns": ["transportadora", "valor_minimo"]
    }
  },

  "regras_interpretacao": {
    "deteccao_cliente": {
      "campo_busca": "raz_social_red",
      "operador": "ILIKE",
      "template": "%{termo}%",
      "case_sensitive": false
    },
    "deteccao_periodo": {
      "hoje": "CURRENT_DATE",
      "ontem": "CURRENT_DATE - 1", 
      "semana": "CURRENT_DATE - INTERVAL '7 days'",
      "mes": "CURRENT_DATE - INTERVAL '30 days'"
    },
    "deteccao_geografica": {
      "sp": "SP", "são paulo": "SP",
      "rj": "RJ", "rio de janeiro": "RJ", 
      "mg": "MG", "minas gerais": "MG"
    }
  },

  "campos_obsoletos_nao_usar": [
    {
      "campo": "valor_frete",
      "modelo": "Pedido", 
      "motivo": "Campo não utilizado nas rotas"
    },
    {
      "campo": "transportadora",
      "modelo": "Pedido",
      "motivo": "Campo não utilizado nas rotas"
    },
    {
      "campo": "cotacao_id", 
      "modelo": "EmbarqueItem",
      "motivo": "Referência obsoleta"
    }
  ],

  "filtros_vendedor": {
    "campo_vinculo": "vendedor_vinculado",
    "aplicar_em": ["EntregaMonitorada", "RelatorioFaturamentoImportado"],
    "campo_filtro": "vendedor"
  },

  "dados_reais_referencia": {
    "transportadoras_ativas": [
      "Transportadora Teste 1 Ltda",
      "Freteiro Autônomo Silva",
      "Transportes Express"
    ],
    "status_mais_comuns": [
      "ABERTO", "COTADO", "FATURADO", "Entregue", "PENDENTE"
    ]
  },

  "prompt_sistema_otimizado": "Você é um assistente especializado no sistema de fretes com acesso aos modelos PRIORITÁRIOS: EntregaMonitorada (principal para monitoramento), Pedido (base operacional), Embarque (logística), Frete (financeiro). REGRAS CRÍTICAS: 1) SEMPRE use dados reais - NUNCA invente clientes/transportadoras, 2) Priorize EntregaMonitorada para consultas de status/entrega, 3) Use ILIKE para busca de clientes, 4) Considere vendedor_vinculado para filtros de usuário, 5) NUNCA use campos obsoletos listados, 6) Para entregas atrasadas: entregue=false AND data_entrega_prevista < CURRENT_DATE",

  "metricas_qualidade": {
    "precisao_consultas_meta": 95,
    "precisao_atual": 87,
    "tempo_resposta_meta": "2s",
    "campos_obsoletos_removidos": 85
  }
} 