---
phase: 02-component-library
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - app/static/css/components/_modals.css
  - app/static/css/components/_forms.css
  - app/static/css/main.css
  - app/static/css/tokens/_design-tokens.css
autonomous: true

must_haves:
  truths:
    - "Modal content uses elevated level background (10% dark, 100% light)"
    - "Modal header and footer have subtle borders that adapt to theme"
    - "Modal sizes (sm, md, lg) are available via Bootstrap classes"
    - "Form inputs have amber glow focus state visible in both themes"
    - "Form validation states (is-valid, is-invalid) have semantic colors"
    - "Required field labels have red asterisk indicator"
    - "Disabled inputs are visually distinct (reduced opacity)"
  artifacts:
    - path: "app/static/css/components/_modals.css"
      provides: "Modal component with elevated background and theme-aware borders"
      min_lines: 50
    - path: "app/static/css/components/_forms.css"
      provides: "Form inputs with focus, validation, and disabled states"
      min_lines: 70
    - path: "app/static/css/main.css"
      provides: "Import statements for _modals.css and _forms.css"
      contains: "@import url('./components/_modals.css') layer(components)"
  key_links:
    - from: "app/static/css/main.css"
      to: "app/static/css/components/_modals.css"
      via: "@import with layer(components)"
      pattern: "@import.*_modals\\.css.*layer\\(components\\)"
    - from: "app/static/css/main.css"
      to: "app/static/css/components/_forms.css"
      via: "@import with layer(components)"
      pattern: "@import.*_forms\\.css.*layer\\(components\\)"
---

<objective>
Extract modal and form components from design-tokens into dedicated files

Purpose: Create modal and form components that complete the Phase 2 component library. Modals implement the "elevated" level of the 3-tier elevation system. Forms have complete state handling (default, focus, error, success, disabled) with theme-aware visual feedback.

Output: `app/static/css/components/_modals.css` and `app/static/css/components/_forms.css` imported into `main.css`
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-component-library/02-RESEARCH.md

## Phase Context (User Decisions)

**Modal Requirements:**
- Sizes: 3 sizes (sm, md/default, lg) - Bootstrap handles widths
- Colors: Follow elevation system (elevated level = --bg-light)
- Borders: Subtle, theme-adaptive
- Shadow: Only at elevated level

**Form Requirements:**
- Input states: Complete (default, focus, error, success, disabled)
- Required indicator: Red asterisk after label
- Spacing: Padronizado via tokens
- Focus: Amber glow visible in both themes

**Elevation System:**
- Background (page): --bg-dark (0% dark, 90% light)
- Surface (cards): --bg (5% dark, 95% light)
- Elevated (modals): --bg-light (10% dark, 100% light)

**Design Tokens Available:**
```css
--bg-light: hsl(0 0% 10%);    /* dark - elevated/modal */
--bg-light: hsl(0 0% 100%);   /* light - elevated/modal */
--border: hsl(0 0% 30%);      /* dark */
--border: hsl(0 0% 80%);      /* light */
--text: hsl(0 0% 95%);        /* dark */
--text: hsl(0 0% 5%);         /* light */
--semantic-success: hsl(145 65% 40%);
--semantic-danger: hsl(0 70% 50%);
--amber-50: hsl(45 100% 50%);
--shadow-lg: 0 4px 8px hsla(...);
```

## Reference Files
@app/static/css/tokens/_design-tokens.css (modals ~447-467, forms/inputs ~322-356)
@app/static/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create _modals.css component file</name>
  <files>app/static/css/components/_modals.css</files>
  <action>
Create `app/static/css/components/_modals.css` with the following structure:

1. **File header comment** explaining modal elevation level

2. **@layer components wrapper** - all styles inside this layer

3. **Modal content** (.modal-content):
   - CSS custom property API (--_modal-bg, --_modal-border, --_modal-shadow)
   - --_modal-bg: var(--bg-light) - ELEVATED level (highest in hierarchy)
     **Note:** The existing design-tokens.css:452 uses var(--gradient) for modal background.
     We intentionally replace this with var(--bg-light) to follow the 3-tier elevation system
     (background -> surface -> elevated). Gradients are removed from component backgrounds
     to ensure consistent theming and predictable layering.
   - --_modal-border: var(--border)
   - --_modal-shadow: 0 4px 8px hsla(0 0% 0% / 0.15), 0 8px 16px hsla(0 0% 0% / 0.2)
   - background: var(--_modal-bg)
   - border: 1px solid var(--_modal-border)
   - box-shadow: var(--_modal-shadow)
   - border-radius: var(--radius-lg)

4. **Modal header** (.modal-header):
   - border-bottom: 1px solid var(--_modal-border)
   - color: var(--text)
   - background: transparent
   - padding: 1rem

5. **Modal body** (.modal-body):
   - color: var(--text)
   - padding: 1rem

6. **Modal footer** (.modal-footer):
   - border-top: 1px solid var(--_modal-border)
   - background: transparent
   - padding: 1rem

7. **Modal title** (.modal-title):
   - color: var(--text)
   - font-weight: 600

8. **Modal backdrop** (.modal-backdrop):
   - background-color: hsla(0 0% 0% / 0.5)

9. **Close button theming** (.modal .btn-close):
   - filter: var(--bs-btn-close-white-filter) for dark mode compatibility

10. **Sizes** - Bootstrap handles .modal-sm, .modal-lg, .modal-xl widths, but ensure:
    - All sizes use same elevation background

**CRITICAL:** Do NOT use !important. The layer system handles specificity.
  </action>
  <verify>
Run: `cat app/static/css/components/_modals.css | head -30` to verify structure
Run: `grep -c "\.modal" app/static/css/components/_modals.css` should return 8+ matches
Run: `grep "!important" app/static/css/components/_modals.css` should return 0 matches
Run: `grep "bg-light" app/static/css/components/_modals.css` - should show elevated background
  </verify>
  <done>
_modals.css exists with elevated background, theme-aware borders, and complete structure
  </done>
</task>

<task type="auto">
  <name>Task 2: Create _forms.css component file</name>
  <files>app/static/css/components/_forms.css</files>
  <action>
Create `app/static/css/components/_forms.css` with the following structure:

1. **File header comment** explaining form state handling

2. **@layer components wrapper** - all styles inside this layer

3. **Base input styles** (.form-control, .form-select):
   - CSS custom property API (--_input-bg, --_input-border, --_input-color, --_input-focus-border, --_input-focus-shadow)
   - --_input-bg: var(--bg-light)
   - --_input-border: var(--border)
   - --_input-color: var(--text)
   - --_input-focus-border: var(--amber-50)
   - --_input-focus-shadow: 0 0 6px 1px hsla(50 100% 55% / 0.6)
   - background: var(--_input-bg)
   - border: 1px solid var(--_input-border)
   - color: var(--_input-color)
   - transition: border-color 0.2s, box-shadow 0.2s
   - border-radius: var(--radius-md)

4. **Focus state** using :where() for easy override:
   - .form-control:where(:focus), .form-select:where(:focus)
   - border-color: var(--_input-focus-border)
   - box-shadow: var(--_input-focus-shadow)
   - outline: none

5. **Validation states**:
   - .form-control.is-valid, .form-select.is-valid:
     - --_input-border: var(--semantic-success)
     - --_input-focus-shadow: 0 0 6px 1px hsla(145 65% 40% / 0.4)
   - .form-control.is-invalid, .form-select.is-invalid:
     - --_input-border: var(--semantic-danger)
     - --_input-focus-shadow: 0 0 6px 1px hsla(0 70% 50% / 0.4)

6. **Disabled state** using :where():
   - :where(:disabled)
   - opacity: 0.65
   - cursor: not-allowed

7. **Placeholder styling**:
   - .form-control::placeholder
   - color: var(--text-muted)

8. **Required field indicator** (.form-label.required):
   - .form-label.required::after
   - content: " *"
   - color: var(--semantic-danger)

9. **Form text** (.form-text):
   - color: var(--text-muted)
   - font-size: 0.875rem

10. **Input groups** (.input-group):
    - .input-group-text
    - background: var(--bg)
    - border: 1px solid var(--border)
    - color: var(--text)

11. **Custom state classes** (for manual state control):
    - .input-state-warning: border-color: var(--amber-50)
    - .input-state-danger: border-color: var(--semantic-danger)
    - .input-state-success: border-color: var(--semantic-success)

**CRITICAL:** Do NOT use !important. The layer system handles specificity.
  </action>
  <verify>
Run: `cat app/static/css/components/_forms.css | head -30` to verify structure
Run: `grep -c "\.form" app/static/css/components/_forms.css` should return 10+ matches
Run: `grep "!important" app/static/css/components/_forms.css` should return 0 matches
Run: `grep "is-valid\|is-invalid" app/static/css/components/_forms.css` - should match validation states
Run: `grep "required::after" app/static/css/components/_forms.css` - should match required indicator
  </verify>
  <done>
_forms.css exists with complete state handling (focus, validation, disabled), required indicator, and input groups
  </done>
</task>

<task type="auto">
  <name>Task 3: Import modals and forms into main.css</name>
  <files>app/static/css/main.css</files>
  <action>
Edit `app/static/css/main.css` to add imports for _modals.css and _forms.css.

**Dependency note:** This plan runs in Wave 2 after 02-01 and 02-02 complete (see depends_on in frontmatter).
By this point, _buttons.css, _cards.css, and _badges.css imports should already exist from Wave 1 plans.

**Before editing, verify Wave 1 imports exist:**
```bash
grep -E "_buttons.css|_cards.css|_badges.css" app/static/css/main.css
```

If any are missing (shouldn't happen since dependencies ensure order), add them.

The Components section should have all 5 component files after this task:
```css
/* Components - Reusable UI patterns */
@import url('./components/_buttons.css') layer(components);
@import url('./components/_cards.css') layer(components);
@import url('./components/_badges.css') layer(components);
@import url('./components/_modals.css') layer(components);
@import url('./components/_forms.css') layer(components);
```

Ensure imports are:
1. After base layer imports
2. Before utilities layer imports
3. All using `layer(components)`
  </action>
  <verify>
Run: `grep "_modals.css\|_forms.css" app/static/css/main.css` - should show both imports
Run: `grep -c "layer(components)" app/static/css/main.css` - should return 5 (all component files)
  </verify>
  <done>
main.css imports all 5 component files (buttons, cards, badges, modals, forms) in the components layer
  </done>
</task>

<task type="auto">
  <name>Task 4: Remove modal and form styles from _design-tokens.css</name>
  <files>app/static/css/tokens/_design-tokens.css</files>
  <action>
In `app/static/css/tokens/_design-tokens.css`, remove:

1. **COMPONENTES - INPUTS section** (should start around the area where BUTTONS section was):
   Look for .form-control and .form-select styles with focus states and input-state-* classes.

2. **COMPONENTES - MODALS section** (starts ~line 447):
   ```css
   /* ═══════════════════════════════════════════════════════════════════════════
      COMPONENTES - MODALS
   ```
   Through .modal-footer styles.

**Keep** the sections:
- COMPONENTES - TABLES (keep - Phase 3)
- COMPONENTES - DROPDOWNS (keep - still needed)
- COMPONENTES - ALERTS (keep - can be extracted later)
- All design tokens (colors, spacing, typography)
- All Bootstrap compatibility utilities

**Important:** After Plans 02-01 and 02-02 have run, the BUTTONS, CARDS, and BADGES sections should already be removed. This plan removes INPUTS and MODALS.

**Check what remains:** After this plan, _design-tokens.css should contain:
- Design token definitions (:root variables)
- Dark/Light mode theme definitions
- body styles
- Table component (Phase 3)
- Dropdown component
- Alert component
- Utilities (backgrounds, text colors, etc.)
- Bootstrap 4→5 compatibility
- Legacy variables
- Print styles
  </action>
  <verify>
Run: `grep -n "COMPONENTES - MODALS" app/static/css/tokens/_design-tokens.css` - should return nothing
Run: `grep -n "\.form-control" app/static/css/tokens/_design-tokens.css` - should return nothing (or minimal)
Run: `grep -n "\.modal-content" app/static/css/tokens/_design-tokens.css` - should return nothing
Run: `grep -n "COMPONENTES - TABLES" app/static/css/tokens/_design-tokens.css` - should still exist
Run: `grep -n ":root" app/static/css/tokens/_design-tokens.css` - should still exist (tokens preserved)
  </verify>
  <done>
Modal and form input styles removed from _design-tokens.css, tables, dropdowns, alerts, and tokens preserved
  </done>
</task>

</tasks>

<verification>
1. **File structure**: _modals.css and _forms.css exist in components/
2. **All components imported**: main.css has 5 component imports (buttons, cards, badges, modals, forms)
3. **No duplicates**: Modal and form styles exist ONLY in component files
4. **No !important**: Zero !important declarations in new component files
5. **Complete extraction**: Only tables, dropdowns, alerts remain as component styles in _design-tokens.css
</verification>

<success_criteria>
- [ ] _modals.css has 50+ lines with modal component (elevated background, header/body/footer)
- [ ] _forms.css has 70+ lines with form component (states, validation, required indicator)
- [ ] main.css imports all 5 component files in components layer
- [ ] _design-tokens.css no longer has modal or form input component styles
- [ ] Zero !important declarations in new component files
- [ ] Required field asterisk indicator works (.form-label.required::after)
</success_criteria>

<output>
After completion, create `.planning/phases/02-component-library/02-03-SUMMARY.md`
</output>
