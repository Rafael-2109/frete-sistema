---
phase: 01-layer-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/static/css/main.css
  - app/static/css/layers/_layer-order.css
  - app/static/css/tokens/.gitkeep
  - app/static/css/base/.gitkeep
  - app/static/css/components/.gitkeep
  - app/static/css/utilities/.gitkeep
  - app/static/css/legacy/.gitkeep
autonomous: true

must_haves:
  truths:
    - "main.css file exists as single CSS entry point"
    - "Layer order is declared before any @import statements"
    - "Folder structure for tokens/, base/, components/, modules/, utilities/, legacy/ exists"
  artifacts:
    - path: "app/static/css/main.css"
      provides: "CSS entry point with @layer declarations"
      min_lines: 30
      contains: "@layer reset, tokens, base, components, modules, utilities, overrides"
    - path: "app/static/css/layers/_layer-order.css"
      provides: "Layer order documentation"
      contains: "@layer"
  key_links:
    - from: "app/static/css/main.css"
      to: "@layer declaration"
      via: "First line after comments"
      pattern: "@layer reset.*overrides"
---

<objective>
Create the main.css entry point with explicit @layer declarations and establish the folder structure for the CSS design system.

Purpose: Establish cascade control via CSS Layers so all subsequent work has predictable specificity without !important battles. This is the foundation for the entire migration.

Output: main.css entry point with 7-layer cascade order, folder structure ready for Phase 2+
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-layer-infrastructure/01-RESEARCH.md

# Current CSS structure
@app/static/css/_design-tokens.css (first 50 lines for variable structure)
@app/static/css/bootstrap-overrides.css (first 50 lines for @import pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create folder structure for CSS layers</name>
  <files>
    app/static/css/layers/
    app/static/css/tokens/
    app/static/css/base/
    app/static/css/components/
    app/static/css/utilities/
    app/static/css/legacy/
  </files>
  <action>
Create the following folder structure under app/static/css/:

```
app/static/css/
├── layers/       # Layer order declaration
├── tokens/       # Design tokens (will receive _design-tokens.css in Plan 03)
├── base/         # Bootstrap overrides, navbar (will receive files in Plan 03)
├── components/   # Phase 2: buttons, cards, badges
├── utilities/    # Will receive _utilities.css in Plan 03
└── legacy/       # Temporary migration overrides
```

Create each directory with a .gitkeep file to ensure they are tracked by git.

For the layers/ folder, create `_layer-order.css` with documentation:

```css
/**
 * CSS Layer Order Declaration
 *
 * Priority (lowest to highest):
 * 1. reset     - Browser normalization (future)
 * 2. tokens    - Design tokens (colors, spacing, typography)
 * 3. base      - Bootstrap overrides, global defaults
 * 4. components - Reusable UI components (buttons, cards, etc.)
 * 5. modules   - Feature-specific styles (carteira, financeiro, etc.)
 * 6. utilities - Utility classes (spacing, visibility, etc.)
 * 7. overrides - Temporary migration overrides (remove when complete)
 *
 * Note: This file is for documentation only.
 * The actual @layer statement lives in main.css
 */
```
  </action>
  <verify>
```bash
# Verify folder structure exists
ls -la app/static/css/layers/
ls -la app/static/css/tokens/
ls -la app/static/css/base/
ls -la app/static/css/components/
ls -la app/static/css/utilities/
ls -la app/static/css/legacy/

# Verify _layer-order.css exists
cat app/static/css/layers/_layer-order.css
```
  </verify>
  <done>
Six new directories exist under app/static/css/ with .gitkeep files, and layers/_layer-order.css contains layer documentation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create main.css entry point with @layer declarations</name>
  <files>app/static/css/main.css</files>
  <action>
Create app/static/css/main.css with the following content:

```css
/**
 * main.css - CSS Entry Point for Nacom Goya Design System
 *
 * This file establishes the CSS cascade layer order and imports
 * all stylesheets in the correct priority sequence.
 *
 * Layer Priority (lowest to highest):
 * 1. reset     - Browser normalization
 * 2. tokens    - Design tokens (colors, spacing, typography)
 * 3. base      - Bootstrap overrides, global defaults
 * 4. components - Reusable UI components (buttons, cards, etc.)
 * 5. modules   - Feature-specific styles (carteira, financeiro, etc.)
 * 6. utilities - Utility classes (spacing, visibility, etc.)
 * 7. overrides - Temporary migration overrides (remove when complete)
 *
 * IMPORTANT: The @layer statement MUST be the first rule.
 * All @import statements MUST come after @layer and before any other rules.
 *
 * Browser Support: 96%+ (all modern browsers since March 2022)
 * Reference: https://developer.mozilla.org/en-US/docs/Web/CSS/@layer
 */

/* ═══════════════════════════════════════════════════════════════════════════
   LAYER ORDER DECLARATION (MUST BE FIRST)
   Lower layers have lower specificity, higher layers can override without !important
   ═══════════════════════════════════════════════════════════════════════════ */

@layer reset, tokens, base, components, modules, utilities, overrides;

/* ═══════════════════════════════════════════════════════════════════════════
   LAYER IMPORTS
   Note: Imports will be added in Plan 01-03 after wrapping existing CSS files
   ═══════════════════════════════════════════════════════════════════════════ */

/* Tokens - Design system variables (Phase 1, Plan 03)
   @import url('./tokens/_design-tokens.css') layer(tokens);
*/

/* Base - Bootstrap overrides and global defaults (Phase 1, Plan 03)
   @import url('./base/_bootstrap-overrides.css') layer(base);
   @import url('./base/_navbar.css') layer(base);
*/

/* Components - Reusable UI patterns (Phase 2)
   @import url('./components/_buttons.css') layer(components);
   @import url('./components/_cards.css') layer(components);
*/

/* Utilities - Helper classes (Phase 1, Plan 03)
   @import url('./utilities/_utilities.css') layer(utilities);
*/

/* Legacy - Temporary overrides during migration (remove after Phase 7)
   @import url('./legacy/_inline-overrides.css') layer(overrides);
*/

/* ═══════════════════════════════════════════════════════════════════════════
   END OF IMPORTS - No additional rules should be added to this file
   ═══════════════════════════════════════════════════════════════════════════ */
```

Key requirements:
- The @layer declaration MUST be the first CSS rule (after comments)
- All @import statements come after @layer, currently commented as placeholders
- No other CSS rules in this file - it's purely an orchestration file
- Comments explain the layer priority and future imports
  </action>
  <verify>
```bash
# Verify main.css exists and has correct structure
cat app/static/css/main.css

# Verify @layer is first rule (after comments)
grep -n "@layer reset" app/static/css/main.css

# Verify no actual CSS rules exist (only @layer and @import)
grep -E "^[a-z\.\#\[\*]" app/static/css/main.css || echo "No CSS rules found (correct)"
```
  </verify>
  <done>
main.css exists with @layer declaration as first rule, commented import placeholders, and no actual CSS rules.
  </done>
</task>

</tasks>

<verification>
Run these checks to verify Phase 1, Plan 01 completion:

```bash
# 1. Folder structure exists
echo "=== Checking folder structure ==="
for dir in layers tokens base components utilities legacy; do
  if [ -d "app/static/css/$dir" ]; then
    echo "OK: $dir/"
  else
    echo "MISSING: $dir/"
  fi
done

# 2. main.css has @layer declaration
echo "=== Checking main.css @layer ==="
grep "@layer reset, tokens, base, components, modules, utilities, overrides" app/static/css/main.css && echo "OK: @layer declaration found" || echo "FAIL: @layer declaration missing"

# 3. _layer-order.css documentation exists
echo "=== Checking layer documentation ==="
[ -f "app/static/css/layers/_layer-order.css" ] && echo "OK: _layer-order.css exists" || echo "FAIL: _layer-order.css missing"
```
</verification>

<success_criteria>
1. Folder structure exists: layers/, tokens/, base/, components/, utilities/, legacy/
2. main.css exists with @layer declaration as first rule
3. Layer order matches: reset, tokens, base, components, modules, utilities, overrides
4. No breaking changes to existing CSS (existing files untouched)
5. layers/_layer-order.css documents the layer hierarchy
</success_criteria>

<output>
After completion, create `.planning/phases/01-layer-infrastructure/01-01-SUMMARY.md`
</output>
