---
phase: 05-high-traffic-migration
plan: 04
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - app/static/css/modules/_embarques.css
  - app/templates/embarques/listar_embarques.html
  - app/templates/embarques/visualizar_embarque.html
autonomous: true

must_haves:
  truths:
    - "listar_embarques.html uses design tokens (no hardcoded colors)"
    - "visualizar_embarque.html uses design tokens"
    - "Print templates (imprimir_*.html) are NOT modified - kept with hardcoded colors"
    - "Dark mode toggle works on non-print embarques templates"
  artifacts:
    - path: "app/static/css/modules/_embarques.css"
      provides: "Embarques module overrides using tokens"
      min_lines: 20
    - path: "app/templates/embarques/listar_embarques.html"
      provides: "Template with token-based colors"
  key_links:
    - from: "app/templates/embarques/listar_embarques.html"
      to: "app/static/css/modules/_embarques.css"
      via: "main.css imports module CSS"
      pattern: "class=.*emb-"
---

<objective>
Migrate embarques module templates (listar_embarques, visualizar_embarque) to design tokens - EXCLUDING print templates

Purpose: Remove hardcoded colors from non-print embarques templates
Output: Templates using design tokens, print templates untouched
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-high-traffic-migration/05-RESEARCH.md
@app/static/css/modules/_embarques.css
@app/static/css/tokens/_design-tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate listar_embarques.html and visualizar_embarque.html</name>
  <files>
    app/templates/embarques/listar_embarques.html
    app/templates/embarques/visualizar_embarque.html
    app/static/css/modules/_embarques.css
  </files>
  <action>
Research indicates:
- listar_embarques.html: 0 hardcoded colors, 9 inline styles (LOW complexity)
- visualizar_embarque.html: 5 hardcoded colors, 17 inline styles (LOW complexity)

1. Read both templates completely
2. Identify any hardcoded colors and inline styles for colors
3. Replace with design tokens or component classes

Strategy for LOW complexity templates:
- Most styling likely uses Bootstrap/component classes already
- Focus on converting any remaining inline color styles
- Create semantic classes only if patterns repeat

For listar_embarques.html:
- Convert inline styles to component classes where possible
- Use .table from _tables.css for table styling
- Use .badge-* from _badges.css for status badges

For visualizar_embarque.html (5 colors):
- Identify what the hardcoded colors are for
- Replace with semantic design tokens

Add to _embarques.css:
```css
/* Embarques List View */
.emb-list-header {
    background: var(--bg-light);
    border-bottom: 1px solid var(--border);
}

.emb-status-badge {
    /* Inherits from .badge, override if needed */
}

/* Embarque Detail View */
.emb-detail-section {
    background: var(--bg-light);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
}

.emb-detail-label {
    color: var(--text-muted);
    font-size: 0.875rem;
}

.emb-detail-value {
    color: var(--text);
    font-weight: 500;
}

/* Status Row Colors */
.emb-row--embarcado {
    background: hsla(145 50% 40% / 0.1);
}

.emb-row--pendente {
    background: hsla(45 90% 50% / 0.1);
}

.emb-row--cancelado {
    background: hsla(0 70% 50% / 0.1);
}
```

CRITICAL: DO NOT modify any templates matching pattern:
- imprimir_completo.html
- imprimir_embarque.html
- imprimir_separacao.html
These print templates must keep hardcoded colors for print reliability.
  </action>
  <verify>
    grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/listar_embarques.html || echo "0 hardcoded colors"
    grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/visualizar_embarque.html || echo "0 hardcoded colors"
    grep "emb-" app/static/css/modules/_embarques.css | head -5
  </verify>
  <done>Both templates have no hardcoded colors, print templates untouched</done>
</task>

<task type="auto">
  <name>Task 2: Verify print templates are untouched</name>
  <files>
    app/templates/embarques/imprimir_completo.html
    app/templates/embarques/imprimir_embarque.html
    app/templates/embarques/imprimir_separacao.html
  </files>
  <action>
This is a VERIFICATION task, not a modification task.

1. Confirm print templates still have hardcoded colors (EXPECTED)
2. Confirm they do NOT use design tokens (EXPECTED)
3. Document that these templates are intentionally excluded

Run these checks:
```bash
# Count hardcoded colors - should be HIGH (32, 26, 14 respectively)
grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/imprimir_completo.html
grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/imprimir_embarque.html
grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/imprimir_separacao.html

# Count var(-- usages - should be ZERO or very low
grep -c "var(--" app/templates/embarques/imprimir_completo.html
```

If var(-- count is high, that's acceptable as long as:
- Body background is white (for print)
- Text color is black/dark (for print)
- No dark mode switching logic

Add comment to _embarques.css documenting exclusion:
```css
/*
 * ═══════════════════════════════════════════════════════════════════════════
 * PRINT TEMPLATES - INTENTIONALLY EXCLUDED
 * ═══════════════════════════════════════════════════════════════════════════
 *
 * The following templates keep hardcoded light mode colors for print reliability:
 * - imprimir_completo.html
 * - imprimir_embarque.html
 * - imprimir_separacao.html
 *
 * These templates do NOT extend base.html and should NOT be migrated to tokens.
 * Print output requires consistent light backgrounds for all printers.
 */
```
  </action>
  <verify>
    # MUST fail if print template hardcoded colors drop below threshold
    count=$(grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/imprimir_completo.html)
    if [ "$count" -lt 30 ]; then echo "ERROR: Print template was modified (count=$count, expected 30+)"; exit 1; fi
    echo "OK: Print template still has $count hardcoded colors (expected 30+)"
    grep "PRINT TEMPLATES" app/static/css/modules/_embarques.css
  </verify>
  <done>Print templates verified as intentionally excluded (30+ hardcoded colors), documented in _embarques.css</done>
</task>

</tasks>

<verification>
1. Run: `grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/listar_embarques.html app/templates/embarques/visualizar_embarque.html`
   Expected: Very low counts (only in comments/URLs)

2. Run: `count=$(grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/embarques/imprimir_completo.html); [ "$count" -ge 30 ] && echo "OK: $count colors" || echo "FAIL: only $count colors"`
   Expected: 30+ colors - print templates MUST keep hardcoded colors (FAILS if below 30)

3. Visual check: Open /embarques/listar in browser
   - Toggle dark/light mode
   - Expected: List adapts correctly to theme

4. Print check: Open /embarques/imprimir_embarque?id=XXX and press Ctrl+P
   - Expected: Print preview shows white background, black text
   - NO dark mode colors in print output
</verification>

<success_criteria>
- listar_embarques.html has no hardcoded hex colors
- visualizar_embarque.html has no hardcoded hex colors
- imprimir_*.html templates are UNCHANGED (still have hardcoded colors)
- _embarques.css documents print template exclusion
- Dark mode works on non-print templates
- Print templates render correctly in print preview
</success_criteria>

<output>
After completion, create `.planning/phases/05-high-traffic-migration/05-04-SUMMARY.md`
</output>
