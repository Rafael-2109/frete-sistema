---
phase: 05-high-traffic-migration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - app/static/css/modules/_financeiro.css
  - app/templates/financeiro/dashboard.html
  - app/templates/financeiro/cnab400_hub.html
  - app/templates/financeiro/cnab400_lote_detalhe.html
autonomous: true

must_haves:
  truths:
    - "Financeiro dashboard uses design tokens (no hardcoded #hex colors)"
    - "CNAB400 hub and lote_detalhe templates use design tokens"
    - "Dark mode toggle works on all migrated financeiro templates"
  artifacts:
    - path: "app/static/css/modules/_financeiro.css"
      provides: "Extracted styles from financeiro templates"
      min_lines: 50
    - path: "app/templates/financeiro/dashboard.html"
      provides: "Dashboard template without hardcoded colors"
  key_links:
    - from: "app/templates/financeiro/dashboard.html"
      to: "app/static/css/modules/_financeiro.css"
      via: "main.css imports module CSS"
      pattern: "class=.*fin-"
---

<objective>
Migrate financeiro module core templates (dashboard, cnab400_hub, cnab400_lote_detalhe) to design tokens

Purpose: Remove hardcoded colors from highest-traffic financeiro templates
Output: Templates using design tokens, styles extracted to _financeiro.css
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-high-traffic-migration/05-RESEARCH.md
@app/static/css/modules/_financeiro.css
@app/static/css/tokens/_design-tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate financeiro/dashboard.html</name>
  <files>
    app/templates/financeiro/dashboard.html
    app/static/css/modules/_financeiro.css
  </files>
  <action>
1. Read app/templates/financeiro/dashboard.html completely
2. Identify all hardcoded colors (#hex values) and inline style attributes
3. Extract styles from {% block extra_css %} to _financeiro.css
4. Replace hardcoded colors with design tokens:
   - #fff, #ffffff -> var(--bg-light)
   - #1a1a2e, #212529 -> var(--text)
   - #6c757d -> var(--text-muted)
   - #e0e0e0, #dee2e6 -> var(--border)
   - #f8f9fa -> var(--bg)
   - #28a745 -> var(--semantic-success)
   - #dc3545 -> var(--semantic-danger)
   - #ffc107 -> var(--amber-50)
   - #007bff -> var(--amber-55)

5. Use semantic class names prefixed with `fin-` (e.g., .fin-section-card)
6. Remove the inline <style> block, leaving only a comment reference:
   ```html
   {% block extra_css %}
   {# Styles moved to modules/_financeiro.css #}
   {% endblock %}
   ```

Color mapping for dashboard.html based on research (20 hardcoded colors):
- Section card backgrounds: var(--bg-light)
- Section link hover: var(--amber-50) with dark text
- Text colors: var(--text) and var(--text-muted)
  </action>
  <verify>
    grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/financeiro/dashboard.html || echo "0 hardcoded colors"
    grep "fin-" app/templates/financeiro/dashboard.html | head -3
  </verify>
  <done>dashboard.html has no hardcoded colors, uses fin-* classes</done>
</task>

<task type="auto">
  <name>Task 2: Migrate cnab400_hub.html and cnab400_lote_detalhe.html</name>
  <files>
    app/templates/financeiro/cnab400_hub.html
    app/templates/financeiro/cnab400_lote_detalhe.html
    app/static/css/modules/_financeiro.css
  </files>
  <action>
These templates have the most hardcoded colors (46 and 79 respectively).

1. Read both templates completely
2. Note: They already use [data-theme="dark"] selectors but with hardcoded hex colors
3. Strategy: Extract the entire <style> blocks to _financeiro.css
4. Replace all hardcoded colors with design tokens

Key patterns to migrate:

For cnab400_hub.html (46 colors):
- .cnab-stat cards: background var(--bg-light), color var(--text)
- .cnab-stat-value: color var(--amber-55) for accent
- Status indicators: use var(--semantic-success/danger)
- Tables: use design system table styles where possible

For cnab400_lote_detalhe.html (79 colors):
- Tab navigation styles
- Status badges: use var(--semantic-*) colors
- Detail cards: var(--bg-light) backgrounds
- Row highlights: var(--amber-50) with reduced opacity

Add to _financeiro.css:
```css
/* CNAB Status Cards */
.cnab-stat {
    background: var(--bg-light);
    border: 1px solid var(--border);
    color: var(--text);
}

.cnab-stat-value {
    color: var(--amber-55);
    font-weight: 600;
}

.cnab-stat-label {
    color: var(--text-muted);
}

/* CNAB Status Badges */
.cnab-status--importado {
    background: hsla(0 0% 50% / 0.15);
    color: var(--text-muted);
}

.cnab-status--aguardando {
    background: hsla(45 90% 50% / 0.15);
    color: var(--amber-50);
}

.cnab-status--concluido {
    background: hsla(145 50% 40% / 0.15);
    color: var(--semantic-success);
}

.cnab-status--erro {
    background: hsla(0 70% 50% / 0.15);
    color: var(--semantic-danger);
}
```

5. Remove the [data-theme="dark"] overrides from templates - the design tokens handle this
6. Update class names in templates to use new semantic classes
  </action>
  <verify>
    grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/financeiro/cnab400_hub.html || echo "0 hardcoded colors"
    grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/financeiro/cnab400_lote_detalhe.html || echo "0 hardcoded colors"
    grep "cnab-" app/static/css/modules/_financeiro.css | head -5
  </verify>
  <done>cnab400_hub.html and cnab400_lote_detalhe.html have no hardcoded colors</done>
</task>

</tasks>

<verification>
1. Run: `grep -c "#[0-9a-fA-F]\{3,6\}" app/templates/financeiro/dashboard.html`
   Expected: 0 or very low (only in comments/URLs)

2. Run: `grep -c "var(--" app/static/css/modules/_financeiro.css`
   Expected: Multiple token usages (20+)

3. Visual check: Open /financeiro/dashboard in browser
   - Toggle dark/light mode
   - Expected: All elements adapt correctly, no white-on-white or black-on-black

4. Visual check: Open /financeiro/cnab400 in browser
   - Toggle dark/light mode
   - Expected: Stat cards and status badges adapt to theme
</verification>

<success_criteria>
- dashboard.html has zero hardcoded hex colors in CSS
- cnab400_hub.html has zero hardcoded hex colors in CSS
- cnab400_lote_detalhe.html has zero hardcoded hex colors in CSS
- _financeiro.css contains extracted styles using design tokens
- Dark mode works correctly on all three templates
</success_criteria>

<output>
After completion, create `.planning/phases/05-high-traffic-migration/05-02-SUMMARY.md`
</output>
