---
phase: 06-medium-traffic-migration
plan: 09
type: execute
wave: 5
depends_on: ["06-01"]
files_modified:
  - app/templates/rastreamento/aceite_lgpd.html
  - app/templates/rastreamento/app_inicio.html
  - app/templates/rastreamento/confirmacao.html
  - app/templates/rastreamento/erro.html
  - app/templates/rastreamento/questionario_entrega.html
  - app/templates/rastreamento/rastreamento_ativo.html
  - app/templates/rastreamento/scanner_qrcode.html
  - app/templates/rastreamento/upload_canhoto.html
  - app/templates/devolucao/termo_descarte.html
  - app/static/css/modules/_rastreamento-standalone.css
  - app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Standalone templates include design tokens directly (no base.html dependency)"
    - "Templates support dark mode via data-bs-theme attribute"
    - "Green theme preserved for rastreamento branding"
  artifacts:
    - path: "app/static/css/modules/_rastreamento-standalone.css"
      provides: "Self-contained styles for standalone pages"
      contains: "@layer modules"
  key_links:
    - from: "app/templates/rastreamento/aceite_lgpd.html"
      to: "app/static/css/modules/_rastreamento-standalone.css"
      via: "direct CSS link"
      pattern: "_rastreamento-standalone.css"
---

<objective>
Migrate standalone templates that don't extend base.html

Purpose: Handle 8 rastreamento + 1 devolucao standalone templates with self-contained CSS
Output: Standalone templates with embedded design tokens and dark mode support
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create standalone CSS file with design tokens</name>
  <files>
    app/static/css/modules/_rastreamento-standalone.css
    app/static/css/main.css
  </files>
  <action>
Create _rastreamento-standalone.css for standalone pages.

This file must be SELF-CONTAINED because standalone templates don't load main.css.

```css
/**
 * _rastreamento-standalone.css - Standalone Page Styles
 *
 * For templates that DON'T extend base.html:
 * - rastreamento/aceite_lgpd.html
 * - rastreamento/app_inicio.html
 * - rastreamento/confirmacao.html
 * - rastreamento/erro.html
 * - rastreamento/questionario_entrega.html
 * - rastreamento/rastreamento_ativo.html
 * - rastreamento/scanner_qrcode.html
 * - rastreamento/upload_canhoto.html
 * - devolucao/termo_descarte.html
 *
 * These templates must include this file directly via <link> tag.
 * Design tokens are DUPLICATED here because main.css is not loaded.
 *
 * Brand: Green primary (delivery tracking theme)
 */

/* ═══════════════════════════════════════════════════════════════════════════
   DESIGN TOKENS (duplicated for standalone use)
   ═══════════════════════════════════════════════════════════════════════════ */

:root {
  /* Core semantic colors */
  --standalone-bg: #f8f9fa;
  --standalone-bg-light: #ffffff;
  --standalone-text: #212529;
  --standalone-text-muted: #6c757d;
  --standalone-border: #dee2e6;

  /* Rastreamento brand: Green primary */
  --standalone-primary: #198754;
  --standalone-primary-light: #d1e7dd;
  --standalone-primary-dark: #146c43;

  /* Status colors */
  --standalone-success: #198754;
  --standalone-danger: #dc3545;
  --standalone-warning: #ffc107;
}

/* Dark mode tokens */
[data-bs-theme="dark"] {
  --standalone-bg: #212529;
  --standalone-bg-light: #2b3035;
  --standalone-text: #f8f9fa;
  --standalone-text-muted: #adb5bd;
  --standalone-border: #495057;

  /* Green primary adjusted for dark mode */
  --standalone-primary: #20c997;
  --standalone-primary-light: #1a4731;
  --standalone-primary-dark: #63e6be;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BASE STYLES
   ═══════════════════════════════════════════════════════════════════════════ */

body {
  background: var(--standalone-bg);
  color: var(--standalone-text);
  font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Cards */
.standalone-card {
  background: var(--standalone-bg-light);
  border: 1px solid var(--standalone-border);
  border-radius: 12px;
  padding: 1.5rem;
}

/* Primary button (green) */
.standalone-btn-primary {
  background: var(--standalone-primary);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

.standalone-btn-primary:hover {
  background: var(--standalone-primary-dark);
}

/* Status indicators */
.standalone-status--success {
  background: var(--standalone-primary-light);
  color: var(--standalone-primary);
}

.standalone-status--danger {
  background: hsla(0 70% 50% / 0.15);
  color: var(--standalone-danger);
}

/* Form elements */
.standalone-input {
  background: var(--standalone-bg-light);
  border: 1px solid var(--standalone-border);
  color: var(--standalone-text);
  border-radius: 8px;
  padding: 0.75rem;
  width: 100%;
}

.standalone-input:focus {
  outline: none;
  border-color: var(--standalone-primary);
  box-shadow: 0 0 0 3px hsla(145 65% 40% / 0.15);
}

/* Text utilities */
.standalone-text-muted {
  color: var(--standalone-text-muted);
}

.standalone-text-primary {
  color: var(--standalone-primary);
}
```

Add import to main.css (even though standalone templates won't use it, this maintains consistency for any future base.html-extending rastreamento templates):

```css
@import url('./modules/_rastreamento-standalone.css') layer(modules);
```
  </action>
  <verify>
    ls app/static/css/modules/_rastreamento-standalone.css
    grep "data-bs-theme" app/static/css/modules/_rastreamento-standalone.css
    grep "_rastreamento-standalone" app/static/css/main.css
  </verify>
  <done>Standalone CSS file created with self-contained design tokens</done>
</task>

<task type="auto">
  <name>Task 2: Migrate standalone templates to use design tokens</name>
  <files>
    app/templates/rastreamento/aceite_lgpd.html
    app/templates/rastreamento/app_inicio.html
    app/templates/rastreamento/confirmacao.html
    app/templates/rastreamento/erro.html
    app/templates/rastreamento/questionario_entrega.html
    app/templates/rastreamento/rastreamento_ativo.html
    app/templates/rastreamento/scanner_qrcode.html
    app/templates/rastreamento/upload_canhoto.html
    app/templates/devolucao/termo_descarte.html
  </files>
  <action>
For each standalone template:

1. Add data-bs-theme attribute to <html> for dark mode support:
   ```html
   <html lang="pt-BR" data-bs-theme="light">
   ```

2. Add CSS link to standalone stylesheet:
   ```html
   <link rel="stylesheet" href="{{ url_for('static', filename='css/modules/_rastreamento-standalone.css') }}">
   ```

3. Replace hardcoded colors with CSS custom properties:
   - Background colors -> var(--standalone-bg), var(--standalone-bg-light)
   - Text colors -> var(--standalone-text), var(--standalone-text-muted)
   - Border colors -> var(--standalone-border)
   - Green/success -> var(--standalone-primary)
   - Danger/error -> var(--standalone-danger)

4. Replace inline style blocks with .standalone-* classes where possible

5. Optionally add theme toggle for user preference (if appropriate for mobile UX)

Research color counts by template:
- aceite_lgpd.html: 20 colors
- questionario_entrega.html: 32 colors (most complex)
- rastreamento_ativo.html: 17 colors
- upload_canhoto.html: 13 colors
- Others: <10 colors each
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/rastreamento/aceite_lgpd.html app/templates/rastreamento/questionario_entrega.html | grep -v "{#" | wc -l
    grep "_rastreamento-standalone.css" app/templates/rastreamento/aceite_lgpd.html
  </verify>
  <done>9 standalone templates migrated to use design tokens</done>
</task>

</tasks>

<verification>
1. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/rastreamento/aceite_lgpd.html app/templates/rastreamento/app_inicio.html app/templates/rastreamento/confirmacao.html app/templates/rastreamento/erro.html app/templates/rastreamento/questionario_entrega.html app/templates/rastreamento/rastreamento_ativo.html app/templates/rastreamento/scanner_qrcode.html app/templates/rastreamento/upload_canhoto.html app/templates/devolucao/termo_descarte.html | grep -v "{#" | wc -l`
   Expected: Near zero

2. Verify CSS link present in templates:
   `grep "_rastreamento-standalone" app/templates/rastreamento/aceite_lgpd.html`
   Expected: Link tag found

3. Visual check: Load standalone templates directly (not through base.html)
   Expected: Correct rendering with green theme

4. Dark mode check: Manually set data-bs-theme="dark" in browser DevTools
   Expected: Colors adapt appropriately
</verification>

<success_criteria>
- _rastreamento-standalone.css created with self-contained tokens
- 9 standalone templates include CSS link
- Templates use CSS custom properties instead of hardcoded colors
- Dark mode support via data-bs-theme attribute
- Green theme preserved for rastreamento branding
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-09-SUMMARY.md`
</output>
