---
phase: 06-medium-traffic-migration
plan: 05
type: execute
wave: 3
depends_on: ["06-01"]
files_modified:
  - app/templates/portal/**/*.html
  - app/static/css/modules/_portal.css
autonomous: true

must_haves:
  truths:
    - "Portal templates (Sendas, Atacadao, Tenda submodules) use design tokens"
    - "Submodule-specific branding preserved where appropriate"
    - "Templates render correctly in dark mode"
  artifacts:
    - path: "app/static/css/modules/_portal.css"
      provides: "Portal module extracted styles"
      contains: "@layer modules"
  key_links:
    - from: "app/templates/portal/**/*.html"
      to: "app/static/css/modules/_portal.css"
      via: "main.css imports"
      pattern: "var\\(--"
---

<objective>
Migrate portal module with Sendas, Atacadao, and Tenda submodules

Purpose: Address multi-submodule structure while maintaining any brand-specific styling
Output: Portal module migrated with 32 templates using design tokens
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze and migrate portal submodules</name>
  <files>
    app/templates/portal/**/*.html
    app/static/css/modules/_portal.css
  </files>
  <action>
1. List and analyze portal submodule structure:
   ```bash
   find app/templates/portal -name "*.html" | head -40
   ```
2. Identify patterns:
   - Common portal patterns (shared across submodules)
   - Sendas-specific styling
   - Atacadao-specific styling
   - Tenda-specific styling
3. Design class naming convention:
   - .portal-* for common patterns
   - .portal-sendas-* for Sendas-specific (if any)
   - .portal-atacadao-* for Atacadao-specific (if any)
   - .portal-tenda-* for Tenda-specific (if any)
4. Extract repeated patterns to _portal.css
5. Replace hardcoded colors with design tokens

Research indicates 62 hardcoded colors across 32 templates.
Expect moderate extraction to _portal.css.

Token mapping:
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- #28a745 -> var(--semantic-success)
- #dc3545 -> var(--semantic-danger)
- #ffc107 -> var(--amber-50)

Note: If submodules have brand colors (e.g., Sendas red, Atacadao yellow):
- Consider whether to preserve with CSS custom properties
- Or migrate to design system amber/semantic colors
- Document decision in _portal.css header
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/portal/ --include="*.html" | grep -v "{#" | wc -l
    grep "@layer modules" app/static/css/modules/_portal.css
  </verify>
  <done>Portal module (all submodules) migrated to design tokens</done>
</task>

<task type="auto">
  <name>Task 2: Migrate rastreamento base-extending templates</name>
  <files>
    app/templates/rastreamento/detalhes.html
    app/templates/rastreamento/monitoramento.html
    app/templates/rastreamento/dashboard.html
    app/static/css/modules/_rastreamento.css
  </files>
  <action>
Migrate the 3 rastreamento templates that extend base.html:
- detalhes.html
- monitoramento.html
- dashboard.html

The 8 standalone templates are deferred to Wave 5 (06-09-PLAN.md).

1. Scan 3 base-extending templates for hardcoded colors
2. Replace with design tokens
3. Extract patterns to _rastreamento.css if significant

Note: Rastreamento uses GREEN as primary color (delivery tracking branding).
Consider using var(--semantic-success) as primary accent for this module.

Token mapping:
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- #28a745, #198754 -> var(--semantic-success) (primary accent for rastreamento)
- #dc3545 -> var(--semantic-danger)
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/rastreamento/detalhes.html app/templates/rastreamento/monitoramento.html app/templates/rastreamento/dashboard.html | grep -v "{#" | wc -l
  </verify>
  <done>Rastreamento base-extending templates use design tokens</done>
</task>

</tasks>

<verification>
1. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/portal/ --include="*.html" | grep -v "{#" | wc -l`
   Expected: Near zero

2. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/rastreamento/detalhes.html app/templates/rastreamento/monitoramento.html app/templates/rastreamento/dashboard.html | grep -v "{#" | wc -l`
   Expected: Near zero

3. Visual check: Load portal and rastreamento templates in dark mode
   Expected: Correct rendering with appropriate contrast

4. Verify standalone rastreamento templates NOT modified:
   ```bash
   ls app/templates/rastreamento/aceite_lgpd.html  # Should exist, unchanged
   ```
</verification>

<success_criteria>
- Portal templates (32 total across Sendas/Atacadao/Tenda) migrated
- Rastreamento base-extending templates (3) migrated
- Standalone rastreamento templates (8) preserved for Wave 5
- _portal.css and _rastreamento.css contain extracted patterns
- All migrated templates render correctly in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-05-SUMMARY.md`
</output>
