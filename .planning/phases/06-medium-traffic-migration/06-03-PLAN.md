---
phase: 06-medium-traffic-migration
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/templates/devolucao/*.html
  - app/templates/pedidos/*.html
  - app/templates/monitoramento/*.html
  - app/static/css/modules/_devolucao.css
autonomous: true

must_haves:
  truths:
    - "Devolucao templates (excluding termo_descarte.html standalone) use design tokens"
    - "Pedidos templates (excluding imprimir_separacao_antecipado.html print) use design tokens"
    - "Monitoramento templates use design tokens"
  artifacts:
    - path: "app/static/css/modules/_devolucao.css"
      provides: "Devolucao module extracted styles"
      contains: "@layer modules"
  key_links:
    - from: "app/templates/devolucao/*.html"
      to: "app/static/css/modules/_devolucao.css"
      via: "main.css imports"
      pattern: "var\\(--"
---

<objective>
Migrate devolucao, pedidos, and monitoramento modules (medium-low complexity)

Purpose: Handle modules with special cases (standalone template, print template, single high-color template)
Output: 3 modules migrated with appropriate handling of special cases
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate devolucao module (16 colors, 5 templates, 1 standalone)</name>
  <files>
    app/templates/devolucao/*.html
    app/static/css/modules/_devolucao.css
    app/static/css/main.css
  </files>
  <action>
1. Create _devolucao.css module file
2. Identify templates:
   - 4 base-extending templates: Migrate normally
   - termo_descarte.html: STANDALONE - defer to Wave 5 with rastreamento standalone handling
3. For base-extending templates:
   - Replace hardcoded colors with design tokens
   - Extract repeated patterns to _devolucao.css
4. Add _devolucao.css import to main.css

Special handling for termo_descarte.html:
- Mark as "DEFERRED - standalone template" in code comments
- Do NOT modify in this plan
- Will be handled in 06-09-PLAN.md (standalone templates)

Token mapping:
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- #28a745 -> var(--semantic-success)
- #dc3545 -> var(--semantic-danger)
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/devolucao/ --include="*.html" | grep -v "{#" | grep -v "termo_descarte" | wc -l
    ls app/static/css/modules/_devolucao.css
  </verify>
  <done>Devolucao templates (excluding standalone) use design tokens</done>
</task>

<task type="auto">
  <name>Task 2: Migrate pedidos and monitoramento modules</name>
  <files>
    app/templates/pedidos/*.html
    app/templates/monitoramento/*.html
  </files>
  <action>
**Pedidos module (20 colors, 14 templates, 1 print template):**

1. Identify print template: imprimir_separacao_antecipado.html
   - SKIP this template per Phase 5 decision [05-04]
   - Print templates keep hardcoded light mode colors
2. Migrate remaining 13 templates:
   - Replace hardcoded colors with design tokens
   - Extract patterns to _pedidos.css if significant repetition

**Monitoramento module (39 colors, 8 templates):**

1. Research indicates single high-color template
2. Scan all 8 templates for hardcoded colors
3. Replace with design tokens
4. If one template has concentrated styles, extract to _monitoramento.css

Token mapping (same as other modules):
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- Success/danger/warning colors -> semantic tokens

Create module CSS files only if 5+ repeated patterns exist.
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/pedidos/ --include="*.html" | grep -v "{#" | grep -v "imprimir" | wc -l
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/monitoramento/ --include="*.html" | grep -v "{#" | wc -l
  </verify>
  <done>Pedidos (excluding print) and monitoramento modules use design tokens</done>
</task>

</tasks>

<verification>
1. Run hardcoded color count for all migrated templates (excluding special cases):
   ```bash
   grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/devolucao/ app/templates/pedidos/ app/templates/monitoramento/ --include="*.html" | grep -v "{#" | grep -v "termo_descarte" | grep -v "imprimir" | wc -l
   ```
   Expected: Near zero

2. Verify special cases NOT modified:
   - ls app/templates/devolucao/termo_descarte.html (should exist, unchanged)
   - grep "style=" app/templates/pedidos/imprimir_separacao_antecipado.html (should have inline styles)

3. Visual check: Load one template from each module in dark mode
   Expected: Correct rendering with appropriate contrast
</verification>

<success_criteria>
- Devolucao base-extending templates migrated (termo_descarte.html deferred)
- Pedidos templates migrated (imprimir_*.html excluded per Phase 5 decision)
- Monitoramento templates migrated
- Module CSS files created where significant patterns extracted
- All migrated templates render correctly in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-03-SUMMARY.md`
</output>
