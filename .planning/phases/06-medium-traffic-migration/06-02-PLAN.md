---
phase: 06-medium-traffic-migration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/templates/comercial/*.html
  - app/templates/estoque/*.html
  - app/templates/cotacao/*.html
  - app/templates/producao/*.html
  - app/templates/custeio/*.html
  - app/templates/portaria/*.html
  - app/templates/integracoes/*.html
  - app/static/css/modules/_comercial.css
autonomous: true

must_haves:
  truths:
    - "Low-complexity modules (comercial, estoque, cotacao, producao, custeio, portaria, integracoes) use design tokens"
    - "Templates render correctly in dark mode"
    - "No hardcoded hex colors remain in migrated templates"
  artifacts:
    - path: "app/static/css/modules/_comercial.css"
      provides: "Comercial module extracted styles"
      contains: "@layer modules"
  key_links:
    - from: "app/templates/comercial/*.html"
      to: "app/static/css/modules/_comercial.css"
      via: "main.css imports"
      pattern: "var\\(--"
---

<objective>
Migrate low-complexity modules (Tier 3) from hardcoded colors to design tokens

Purpose: Quick wins on modules with <50 hardcoded colors that follow standard patterns
Output: 7 modules migrated with extracted styles where needed
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate comercial module (27 colors, 8 templates)</name>
  <files>
    app/templates/comercial/*.html
    app/static/css/modules/_comercial.css
    app/static/css/main.css
  </files>
  <action>
1. Create _comercial.css module file following Phase 5 pattern
2. Scan all comercial templates for inline styles and hardcoded colors
3. Replace hardcoded colors with design tokens:
   - #fff, #ffffff -> var(--bg-light)
   - #f8f9fa -> var(--bg)
   - #212529 -> var(--text)
   - #6c757d -> var(--text-muted)
   - #dee2e6, #e0e0e0 -> var(--border)
   - #28a745, #198754 -> var(--semantic-success)
   - #dc3545 -> var(--semantic-danger)
   - #ffc107 -> var(--amber-50)
   - #007bff, #0d6efd -> var(--amber-55)
4. Extract any repeated inline styles to _comercial.css
5. Add _comercial.css import to main.css
6. Remove inline style blocks from templates where styles were extracted

Token mapping reference from research:
| Hardcoded | Token | Context |
|-----------|-------|---------|
| #fff | var(--bg-light) | Card backgrounds |
| #f8f9fa | var(--bg) | Page backgrounds |
| #212529 | var(--text) | Primary text |
| #6c757d | var(--text-muted) | Secondary text |
| #dee2e6 | var(--border) | Borders |
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/comercial/ --include="*.html" | grep -v "{#" | head -20
    grep "@layer modules" app/static/css/modules/_comercial.css
  </verify>
  <done>Comercial templates use design tokens, no hardcoded hex colors remain</done>
</task>

<task type="auto">
  <name>Task 2: Migrate estoque, cotacao, producao, custeio, portaria, integracoes modules</name>
  <files>
    app/templates/estoque/*.html
    app/templates/cotacao/*.html
    app/templates/producao/*.html
    app/templates/custeio/*.html
    app/templates/portaria/*.html
    app/templates/integracoes/*.html
  </files>
  <action>
Migrate remaining low-complexity modules using the same token mapping:

1. **estoque** (12 colors, 7 templates): Standard form/table patterns
2. **cotacao** (6 colors, 6 templates): Minimal changes expected
3. **producao** (5 colors, 8 templates): Very few changes needed
4. **custeio** (4 colors, 8 templates): Minimal changes expected
5. **portaria** (2 colors, 5 templates): Very few changes needed
6. **integracoes** (3 colors, 7 templates): TagPlus views

For each module:
- Scan templates for hardcoded hex colors
- Replace with appropriate design tokens
- If any module has significant repeated patterns (unlikely given low counts), extract to module CSS file
- Most modules in this group should only need inline color replacements

Do NOT create separate CSS files for modules with very few styles.
Only create CSS file if there are 5+ repeated style patterns to extract.

Focus on:
- Background colors (white, gray variants)
- Text colors (dark, muted)
- Border colors
- Status colors (success, danger, warning)
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/estoque/ app/templates/cotacao/ app/templates/producao/ app/templates/custeio/ app/templates/portaria/ app/templates/integracoes/ --include="*.html" | grep -v "{#" | wc -l
  </verify>
  <done>Six low-complexity modules migrated to design tokens</done>
</task>

</tasks>

<verification>
1. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/comercial/ app/templates/estoque/ app/templates/cotacao/ app/templates/producao/ app/templates/custeio/ app/templates/portaria/ app/templates/integracoes/ --include="*.html" | grep -v "{#" | wc -l`
   Expected: Near zero (Jinja comments excluded)

2. Visual check: Load one template from each module in browser
   Expected: Correct rendering in both light and dark modes

3. Run: `grep "var(--" app/templates/comercial/*.html | head -5`
   Expected: Design token references visible
</verification>

<success_criteria>
- All 7 modules migrated from hardcoded colors to design tokens
- _comercial.css created if significant patterns extracted
- Templates render correctly in dark mode
- No regression in light mode appearance
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-02-SUMMARY.md`
</output>
