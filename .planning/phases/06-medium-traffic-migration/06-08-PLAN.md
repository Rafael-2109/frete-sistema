---
phase: 06-medium-traffic-migration
plan: 08
type: execute
wave: 4
depends_on: ["06-01"]
files_modified:
  - app/templates/pallet/**/*.html
  - app/static/css/modules/_pallet.css
autonomous: true

must_haves:
  truths:
    - "Pallet v2 templates use design tokens (554 colors migrated)"
    - "Stat cards, status badges, and page headers use extracted CSS classes"
    - "Templates render correctly in dark mode"
  artifacts:
    - path: "app/static/css/modules/_pallet.css"
      provides: "Pallet module extracted styles (largest migration)"
      contains: ".pallet-stat"
      min_lines: 200
  key_links:
    - from: "app/templates/pallet/v2/*.html"
      to: "app/static/css/modules/_pallet.css"
      via: "main.css imports"
      pattern: "pallet-stat|pallet-status"
---

<objective>
Migrate pallet module (largest migration target - 554 hardcoded colors)

Purpose: Handle the most complex module with extensive inline CSS blocks across 24 templates
Output: Pallet module migrated with comprehensive style extraction to _pallet.css
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze pallet v2 patterns and design extraction strategy</name>
  <files>
    app/templates/pallet/**/*.html
  </files>
  <action>
1. List pallet template structure:
   ```bash
   find app/templates/pallet -name "*.html"
   ```
2. Focus on v2/ templates (14 templates with extensive inline CSS)
3. Identify common patterns from research:
   - Stat cards (.stat-card, .stat-icon)
   - Status badges (.status-badge--*)
   - Page headers with breadcrumbs
   - Table styling
4. Sample one v2 template (e.g., direcionamento.html) to map patterns:
   ```css
   .stat-icon.total { background: #e8f4fd; color: #0d6efd; }
   .stat-icon.transportadora { background: #cff4fc; color: #0dcaf0; }
   .stat-icon.cliente { background: #d1e7dd; color: #198754; }
   ```
5. Design class naming convention:
   - .pallet-stat for stat card containers
   - .pallet-stat__icon--* for icon variants (total, transportadora, cliente, etc.)
   - .pallet-status--* for status badges
   - .pallet-header for page headers
   - .pallet-table for table styling

Document pattern inventory before extraction.
  </action>
  <verify>
    find app/templates/pallet/v2 -name "*.html" | wc -l
    grep -l "stat-icon" app/templates/pallet/v2/*.html | wc -l
  </verify>
  <done>Pallet v2 patterns analyzed, extraction strategy documented</done>
</task>

<task type="auto">
  <name>Task 2: Extract pallet patterns and migrate templates</name>
  <files>
    app/templates/pallet/**/*.html
    app/static/css/modules/_pallet.css
  </files>
  <action>
Build comprehensive _pallet.css with extracted patterns:

1. **Stat Cards Section:**
```css
/* Pallet Stat Cards */
.pallet-stat {
  background: var(--bg-light);
  border-radius: 12px;
  padding: 1.25rem;
  box-shadow: 0 2px 8px hsla(0 0% 0% / 0.08);
  border: 1px solid var(--border);
}

.pallet-stat__icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
}

/* Icon variants using design tokens */
.pallet-stat__icon--total {
  background: hsla(210 100% 95% / 1);
  color: hsl(210 100% 50%);
}

.pallet-stat__icon--transportadora {
  background: hsla(190 90% 92% / 1);
  color: hsl(190 85% 45%);
}

.pallet-stat__icon--cliente {
  background: hsla(145 60% 90% / 1);
  color: var(--semantic-success);
}

.pallet-stat__icon--pendente {
  background: hsla(45 100% 90% / 1);
  color: var(--amber-50);
}
```

2. **Status Badges Section:**
```css
/* Pallet Status Badges */
.pallet-status {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.35rem 0.75rem;
  border-radius: 50px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.pallet-status--aguardando {
  background: hsla(45 90% 50% / 0.15);
  color: var(--amber-50);
}

.pallet-status--direcionado {
  background: hsla(190 65% 45% / 0.15);
  color: hsl(190 65% 40%);
}

.pallet-status--concluido {
  background: hsla(145 50% 40% / 0.15);
  color: var(--semantic-success);
}

.pallet-status--erro {
  background: hsla(0 70% 50% / 0.15);
  color: var(--semantic-danger);
}
```

3. **Page Header Section:**
```css
/* Pallet Page Headers */
.pallet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border);
}

.pallet-header__title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text);
}
```

4. Migrate all 24 pallet templates:
   - Replace inline <style> blocks with class references
   - Replace hardcoded colors with design tokens
   - Update class names to use .pallet-* convention

Token mapping:
- #e8f4fd, #cff4fc -> hsla() variants based on hue
- #0d6efd, #0dcaf0 -> hsl() color values
- #d1e7dd, #198754 -> semantic success tokens
- Standard token mapping for text, bg, border
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/pallet/ --include="*.html" | grep -v "{#" | wc -l
    grep "pallet-stat" app/static/css/modules/_pallet.css
    wc -l app/static/css/modules/_pallet.css
  </verify>
  <done>Pallet templates (24 total) migrated with comprehensive style extraction</done>
</task>

</tasks>

<verification>
1. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/pallet/ --include="*.html" | grep -v "{#" | wc -l`
   Expected: Near zero (from 554)

2. Check extracted styles:
   `wc -l app/static/css/modules/_pallet.css` > 200 lines
   Expected: Comprehensive extraction

3. Verify pattern usage:
   `grep "pallet-stat" app/templates/pallet/v2/*.html | head -5`
   Expected: Class references instead of inline styles

4. Visual check: Load pallet v2 templates in dark mode
   Expected: Stat cards, status badges render correctly
</verification>

<success_criteria>
- All 24 pallet templates migrated (554 colors addressed)
- _pallet.css contains 200+ lines of extracted patterns
- Stat cards, status badges, page headers use CSS classes
- Templates use design tokens instead of hardcoded colors
- All templates render correctly in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-08-SUMMARY.md`
</output>
