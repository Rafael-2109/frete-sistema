---
phase: 06-medium-traffic-migration
plan: 04
type: execute
wave: 3
depends_on: ["06-01"]
files_modified:
  - app/templates/recebimento/*.html
  - app/templates/fretes/*.html
  - app/static/css/modules/_recebimento.css
  - app/static/css/modules/_fretes.css
autonomous: true

must_haves:
  truths:
    - "Recebimento templates use design tokens (high inline style count addressed)"
    - "Fretes templates use design tokens (audit views preserved)"
    - "Fiscal forms maintain functionality with tokenized colors"
  artifacts:
    - path: "app/static/css/modules/_recebimento.css"
      provides: "Recebimento module extracted styles"
      contains: "@layer modules"
    - path: "app/static/css/modules/_fretes.css"
      provides: "Fretes module extracted styles"
      contains: "@layer modules"
  key_links:
    - from: "app/templates/recebimento/*.html"
      to: "app/static/css/modules/_recebimento.css"
      via: "main.css imports"
      pattern: "var\\(--"
---

<objective>
Migrate recebimento and fretes modules (high inline style count)

Purpose: Address modules with 95-100 inline style attributes that need careful extraction
Output: 2 high-volume modules migrated with styles properly extracted to module CSS files
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate recebimento module (43 colors, 100 inline styles)</name>
  <files>
    app/templates/recebimento/*.html
    app/static/css/modules/_recebimento.css
  </files>
  <action>
1. Scan all 14 recebimento templates for inline styles and hardcoded colors
2. Categorize patterns:
   - Fiscal form styling (validation states, field highlights)
   - Table styling (row status colors)
   - Button/action styling
   - Card/panel backgrounds
3. Extract repeated patterns to _recebimento.css with semantic class names:
   - .rec-form-* for fiscal form components
   - .rec-status-* for status indicators
   - .rec-table-* for table-specific styles
4. Replace hardcoded colors with design tokens
5. Remove inline styles from templates where styles were extracted

High inline style count (100) indicates significant extraction needed.
Focus on:
- Background colors for form validation states
- Border colors for field groupings
- Text colors for status messages
- Row highlight colors for table states

Token mapping:
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- #28a745 -> var(--semantic-success)
- #dc3545 -> var(--semantic-danger)
- #ffc107 -> var(--amber-50)
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/recebimento/ --include="*.html" | grep -v "{#" | wc -l
    grep "@layer modules" app/static/css/modules/_recebimento.css
    wc -l app/static/css/modules/_recebimento.css
  </verify>
  <done>Recebimento templates use design tokens with styles extracted to module CSS</done>
</task>

<task type="auto">
  <name>Task 2: Migrate fretes module (28 colors, 95 inline styles)</name>
  <files>
    app/templates/fretes/*.html
    app/static/css/modules/_fretes.css
  </files>
  <action>
1. Scan all 39 fretes templates for inline styles and hardcoded colors
2. Categorize patterns:
   - Audit view styling (comparison tables, diff highlights)
   - Dashboard cards and metrics
   - Table styling (freight status colors)
   - Form inputs and selects
3. Extract repeated patterns to _fretes.css with semantic class names:
   - .frt-audit-* for audit-specific components
   - .frt-status-* for status indicators
   - .frt-metric-* for dashboard metrics
4. Replace hardcoded colors with design tokens
5. Remove inline styles from templates where styles were extracted

High inline style count (95) indicates significant extraction needed.
Focus on:
- Audit comparison highlights (added, removed, changed)
- Freight status colors (pendente, aprovado, rejeitado)
- Metric card backgrounds
- Table row status colors

Token mapping:
- #fff -> var(--bg-light)
- #f8f9fa -> var(--bg)
- #212529 -> var(--text)
- #6c757d -> var(--text-muted)
- #dee2e6 -> var(--border)
- #28a745 -> var(--semantic-success)
- #dc3545 -> var(--semantic-danger)
- #ffc107 -> var(--amber-50)
  </action>
  <verify>
    grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/fretes/ --include="*.html" | grep -v "{#" | wc -l
    grep "@layer modules" app/static/css/modules/_fretes.css
    wc -l app/static/css/modules/_fretes.css
  </verify>
  <done>Fretes templates use design tokens with styles extracted to module CSS</done>
</task>

</tasks>

<verification>
1. Run: `grep -r "#[0-9a-fA-F]\{3,6\}" app/templates/recebimento/ app/templates/fretes/ --include="*.html" | grep -v "{#" | wc -l`
   Expected: Near zero

2. Check extracted styles:
   - `wc -l app/static/css/modules/_recebimento.css` > 50 lines
   - `wc -l app/static/css/modules/_fretes.css` > 50 lines

3. Visual check: Load recebimento and fretes templates in dark mode
   Expected: Correct rendering with proper contrast

4. Functional check: Ensure fiscal forms and audit views maintain functionality
</verification>

<success_criteria>
- Recebimento templates migrated with 100 inline styles addressed
- Fretes templates migrated with 95 inline styles addressed
- Both module CSS files contain extracted patterns
- Fiscal forms and audit views function correctly
- All templates render correctly in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-04-SUMMARY.md`
</output>
