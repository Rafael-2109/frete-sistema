---
phase: 06-medium-traffic-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/static/css/modules/_pallet.css
  - app/static/css/modules/_recebimento.css
  - app/static/css/modules/_portal.css
  - app/static/css/modules/_fretes.css
  - app/static/css/modules/_bi.css
  - app/static/css/modules/_motochefe.css
  - app/static/css/modules/_manufatura.css
  - app/static/css/modules/_rastreamento.css
  - app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Module CSS files exist for all Phase 6 modules"
    - "main.css imports all new module files in @layer modules"
    - "Each module file follows the established Phase 5 pattern with token mapping documentation"
  artifacts:
    - path: "app/static/css/modules/_pallet.css"
      provides: "Pallet module overrides (largest migration target)"
      contains: "@layer modules"
    - path: "app/static/css/modules/_recebimento.css"
      provides: "Recebimento module overrides"
      contains: "@layer modules"
    - path: "app/static/css/modules/_portal.css"
      provides: "Portal module overrides"
      contains: "@layer modules"
    - path: "app/static/css/modules/_fretes.css"
      provides: "Fretes module overrides"
      contains: "@layer modules"
    - path: "app/static/css/modules/_bi.css"
      provides: "BI module overrides with chart tokens"
      contains: "@layer modules"
    - path: "app/static/css/modules/_motochefe.css"
      provides: "Motochefe module overrides"
      contains: "@layer modules"
    - path: "app/static/css/modules/_manufatura.css"
      provides: "Manufatura module overrides"
      contains: "@layer modules"
    - path: "app/static/css/modules/_rastreamento.css"
      provides: "Rastreamento module overrides (base-extending templates)"
      contains: "@layer modules"
    - path: "app/static/css/main.css"
      provides: "Module imports for all Phase 6 modules"
      contains: "_pallet.css"
  key_links:
    - from: "app/static/css/main.css"
      to: "app/static/css/modules/_pallet.css"
      via: "@import url('./modules/_pallet.css') layer(modules)"
      pattern: "@import.*_pallet.*layer\\(modules\\)"
---

<objective>
Create module CSS files for all Phase 6 modules and integrate them into main.css

Purpose: Establish CSS infrastructure that will receive migrated styles from templates during Phase 6
Output: Eight module CSS files with proper @layer modules wrapper, integrated into main.css
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-medium-traffic-migration/06-RESEARCH.md
@app/static/css/main.css
@app/static/css/modules/_financeiro.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create module CSS files for Phase 6 modules</name>
  <files>
    app/static/css/modules/_pallet.css
    app/static/css/modules/_recebimento.css
    app/static/css/modules/_portal.css
    app/static/css/modules/_fretes.css
    app/static/css/modules/_bi.css
    app/static/css/modules/_motochefe.css
    app/static/css/modules/_manufatura.css
    app/static/css/modules/_rastreamento.css
  </files>
  <action>
Create eight module CSS files following the established pattern from _financeiro.css.

Each file should include:
1. Header comment with module name and purpose
2. Token mapping documentation (same as _financeiro.css)
3. Module-specific notes about special cases
4. @layer modules wrapper
5. Placeholder comment for future styles

For _pallet.css (largest migration - 554 colors, 24 templates):
```css
/**
 * _pallet.css - Pallet Module Overrides
 *
 * Component overrides specific to the pallet module.
 * NOTE: Pallet v2 templates have extensive inline CSS blocks with
 * stat cards, status badges, and page headers that need extraction.
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success/danger) for status colors
 * - Use var(--amber-50/55) for accent colors
 *
 * Pallet-specific patterns to extract:
 * - .pallet-stat-* for stat card icons
 * - .pallet-status-* for status badges
 * - .pallet-page-header for page headers
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     PALLET MODULE - Component overrides
     Migrated from template inline styles
     Templates: 24 total (14 in v2/ with extensive inline CSS)
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _recebimento.css (43 colors, 100 inline styles, fiscal forms):
```css
/**
 * _recebimento.css - Recebimento Module Overrides
 *
 * Component overrides specific to the recebimento module.
 * NOTE: High inline style count - fiscal forms need careful migration.
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success/danger) for status colors
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     RECEBIMENTO MODULE - Component overrides
     Migrated from template inline styles
     Templates: 14 total
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _portal.css (62 colors, 32 templates with Sendas/Atacadao/Tenda submodules):
```css
/**
 * _portal.css - Portal Module Overrides
 *
 * Component overrides specific to the portal module.
 * NOTE: Contains Sendas, Atacadao, and Tenda submodules.
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success/danger) for status colors
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     PORTAL MODULE - Component overrides
     Migrated from template inline styles
     Templates: 32 total (Sendas, Atacadao, Tenda submodules)
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _fretes.css (28 colors, 95 inline styles, audit views):
```css
/**
 * _fretes.css - Fretes Module Overrides
 *
 * Component overrides specific to the fretes module.
 * NOTE: High inline style count - audit views need careful migration.
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success/danger) for status colors
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     FRETES MODULE - Component overrides
     Migrated from template inline styles
     Templates: 39 total
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _bi.css (92 colors, Chart.js integration):
```css
/**
 * _bi.css - BI Module Overrides
 *
 * Component overrides specific to the BI module.
 * NOTE: Contains Chart.js integration with hardcoded colors.
 * Chart colors should be read from CSS custom properties.
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 *
 * Chart-specific tokens (for JS to read):
 * - --chart-primary: Primary chart color
 * - --chart-secondary: Secondary chart color
 * - --chart-success: Success color for charts
 * - --chart-danger: Danger color for charts
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     BI MODULE - Component overrides
     Migrated from template inline styles
     Templates: 4 total (with Chart.js visualizations)
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Chart color tokens for JS access */
  :root {
    --chart-primary: var(--amber-55);
    --chart-secondary: var(--amber-40);
    --chart-success: var(--semantic-success);
    --chart-danger: var(--semantic-danger);
    --chart-info: hsl(190 65% 45%);
    --chart-bg-primary: hsla(45 100% 50% / 0.1);
    --chart-bg-secondary: hsla(45 100% 50% / 0.05);
  }

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _motochefe.css (97 colors, 47 templates, 2 print templates to skip):
```css
/**
 * _motochefe.css - Motochefe Module Overrides
 *
 * Component overrides specific to the motochefe module.
 * NOTE: Large subsystem with 47 templates.
 * EXCLUDES: imprimir_devolucao.html, imprimir.html (print templates)
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success/danger) for status colors
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     MOTOCHEFE MODULE - Component overrides
     Migrated from template inline styles
     Templates: 45 non-print (2 print templates EXCLUDED)
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _manufatura.css (26 colors, already partially theme-aware):
```css
/**
 * _manufatura.css - Manufatura Module Overrides
 *
 * Component overrides specific to the manufatura module.
 * NOTE: Already partially theme-aware (uses var(--bs-*)).
 * Only remaining hardcoded colors need migration.
 * EXCLUDES: programacao_linhas_print.html (print template)
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     MANUFATURA MODULE - Component overrides
     Migrated from template inline styles
     Templates: 20 non-print (1 print template EXCLUDED)
     NOTE: Partially theme-aware - verify existing var(--bs-*) work in dark mode
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```

For _rastreamento.css (for 3 base-extending templates only):
```css
/**
 * _rastreamento.css - Rastreamento Module Overrides
 *
 * Component overrides for rastreamento templates that extend base.html.
 * NOTE: Only 3 templates extend base.html (detalhes, monitoramento, dashboard).
 * The 8 standalone templates are handled by _rastreamento-standalone.css (Phase 6 Wave 5).
 *
 * Token mapping:
 * - Use var(--bg-light) for card backgrounds
 * - Use var(--text) for primary text
 * - Use var(--text-muted) for secondary text
 * - Use var(--border) for borders
 * - Use var(--semantic-success) for primary accent (green theme)
 */

@layer modules {

  /* ═══════════════════════════════════════════════════════════════════════════
     RASTREAMENTO MODULE - Component overrides
     Migrated from template inline styles
     Templates: 3 base-extending (detalhes, monitoramento, dashboard)
     NOTE: 8 standalone templates handled separately
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Placeholder - styles will be added as templates are migrated */

} /* End @layer modules */
```
  </action>
  <verify>
    ls -la app/static/css/modules/_pallet.css app/static/css/modules/_recebimento.css app/static/css/modules/_portal.css app/static/css/modules/_fretes.css app/static/css/modules/_bi.css app/static/css/modules/_motochefe.css app/static/css/modules/_manufatura.css app/static/css/modules/_rastreamento.css
    grep "@layer modules" app/static/css/modules/_pallet.css app/static/css/modules/_bi.css
  </verify>
  <done>Eight module CSS files exist with @layer modules wrapper and documentation</done>
</task>

<task type="auto">
  <name>Task 2: Integrate new modules into main.css</name>
  <files>app/static/css/main.css</files>
  <action>
Add imports for the eight new module CSS files to main.css.

Insert after the existing module imports (_financeiro, _carteira, _embarques) and before the utilities imports:

```css
/* Modules - Feature-specific styles */
@import url('./modules/_financeiro.css') layer(modules);
@import url('./modules/_carteira.css') layer(modules);
@import url('./modules/_embarques.css') layer(modules);
@import url('./modules/_pallet.css') layer(modules);
@import url('./modules/_recebimento.css') layer(modules);
@import url('./modules/_portal.css') layer(modules);
@import url('./modules/_fretes.css') layer(modules);
@import url('./modules/_bi.css') layer(modules);
@import url('./modules/_motochefe.css') layer(modules);
@import url('./modules/_manufatura.css') layer(modules);
@import url('./modules/_rastreamento.css') layer(modules);
```

The order should be:
1. @layer declaration
2. Fonts import
3. Tokens import
4. Base imports
5. Components imports
6. **Modules imports** (Phase 5 + Phase 6)
7. Utilities import
  </action>
  <verify>
    grep -A15 "Modules -" app/static/css/main.css
    grep "layer(modules)" app/static/css/main.css | wc -l
  </verify>
  <done>main.css imports all 11 module files (3 from Phase 5 + 8 new)</done>
</task>

</tasks>

<verification>
1. Run: `ls app/static/css/modules/*.css | wc -l`
   Expected: 11 (3 from Phase 5 + 8 new)

2. Run: `grep "@layer modules" app/static/css/modules/_pallet.css app/static/css/modules/_bi.css`
   Expected: Both files show @layer modules

3. Run: `grep "layer(modules)" app/static/css/main.css | wc -l`
   Expected: 11 lines

4. Visual check: Load any page in browser, open DevTools > Network
   Expected: All module CSS files load without 404 errors
</verification>

<success_criteria>
- Eight new module CSS files created in app/static/css/modules/
- Each file wrapped in @layer modules with proper documentation
- _bi.css includes chart color tokens for JS access
- main.css imports all 11 module files with layer(modules)
- No console errors when loading the site
</success_criteria>

<output>
After completion, create `.planning/phases/06-medium-traffic-migration/06-01-SUMMARY.md`
</output>
